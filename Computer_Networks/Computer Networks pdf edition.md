# 计算机网络 笔记

- 📅 更新时间:
  - [[September 11th, 2020]] 13:45: 更新 物理层 内容。
  - [[September 13th, 2020]] 19:22: 更新 数据链路层 内容。
  - [[September 26th, 2020]] 17:23: 更新 网络层 内容。
  - [[September 27th, 2020]] 16:25: 更新 传输层 内容。
  - [[September 30th, 2020]] 12:45: 更新 应用层 内容。

- 📔 下载链接: [《计算机网络笔记 PDF Edition》hosted by 坚果云](https://www.jianguoyun.com/p/DbennHYQsMzzBhiL_cAD)

- 🔗 项目地址: [Roam Research](https://roamresearch.com/#/app/AFuture/page/Ep9sH05FO) | [Github](https://github.com/AFutureD/How-to-learn-408) | [Gitbook](https://github.com/AFutureD/How-to-learn-408)

- ⚠️ 笔记作者: AFuture

- ⚠️ 版权声明: 本笔记所有内容除特别声明外，均采用 [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/) 许可协议。转载请注明来自 AFuture 

<div style="page-break-after:always;"></div>

## 第一章 概述

- 待完成

<div style="page-break-after:always;"></div>

## 第二章 物理层

### 2.1 通信基础

- 2.1.1 基本概念
  
    - 1. 数据、信号与码元
        - 数据
            - 数据是指传送信息的实体
        - 信号
            - 信号是指数据的电气或电磁表现,是数据在传输过程中的存在形式。
        - “模拟的”或“数字的”
            - ①连续变化的数据(或信号)称为模拟数据(或模拟信号);
            - ②取值仅允许为有限的几个离散数值的数据(或信号)称为数字数据(或数字信号)。
        - 数据传输方式
            - 串行传输
                - 串行传输是指一个一个的比特按照时间顺序传输出于经济上的考虑,远距离通信通常采用串行传输
            - 并行传输
                - 并行传输是指多个比特通过多条通信信道同时传输。
        - 码元
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FaL7CMPIyRk.png?alt=media&token=d8532d16-dbe4-4e3d-8b2a-fe651b9efd11)
            - 码元是指用一个固定时长的信号波形(数字脉冲)表示一位k进制数字,代表不同离散数值的基本波形,是数字通信中数字信号的计量单位,这个时长内的信号称为k进制码元,而该时长称为码元宽度。1码元可以携带多个比特的信息量。左图代表 二进制码元；右图代表 四进制码元。
            - 左图，一个T内的脉冲表示一个码元，且最多可以有2种不同的脉冲，说明最多可代表2种不同的值，即 1 bit 的数据；
            - 右图，一个T内的脉冲表示一个码元，且最多有4种不用的脉冲，说明最多可以代表4种不同的值，即 2 bit 的数据。
            - 同理，八进制码元代表 3 bit 数据。
    - 2. 信源、信道与信宿
        - 数据通信系统
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2Fo1_6C5JZ9U.png?alt=media&token=ad3db876-77c0-46ed-8e03-404afb40debb)
            - 信源
                - 信源是产生和发送数据的源头
            - 信宿
                - 信宿是接收数据的终点它们通常都是计算机或其他数字终端装置。
            - 信道
                - 发送端信源发出的信息需要通过变换器转换成适合于在信道上传输的信号,而通过信道传输到接收端的信号先由反变换器转换成原始信息,再发送给信宿
                    - 信道是信号的传输媒介
                    - 个信道可视为一条线路的逻辑部件
                    - 噪声源
                        - 噪声源是信道上的噪声(即对信号的干扰)及分散在通信系统其他各处的噪声的集中表示
                    - 传输信号形式的不同
                        - 传送模拟信号的模拟信道
                        - 传送数字信号的数字信道
                    - 信道按传输介质的不同
                        - 无线信道
                        - 有线信道
                    - 信道上传送的信号有基带信号和宽带信号之分
                        - 基带信号将数字信号1和0直接用两种不同的电压表示,然后送到数字信道上传输(称为基带传输)
                        - 宽带信号将基带信号进行调制后形成频分复用模拟信号,然后传送到模拟信道上去传输(称为宽带传输)
                    - 通信双方信息的交互方式
                        - 单工通信
                            - 只有一个方向的通信而没有反方向的交互,仅需要一条信道。
                        - 半双工通信
                            - 通信的双方都可以发送或接收信息,但任何一方都不能同时发送和接收信息,此时需要两条信道。
                        - 全双工通信
                            - 通信双方可以同时发送和接收信息,也需要两条信道。
                    - 信道的极限容量
                        - 信道的极限容量是指信道的最高码元传输速率或信道的极限信息传输速率
    - 3. 速率、波特与带宽
        - 速率
            - 速率也称数据率,指的是数据的传输速率,表示单位时间内传输的数据量。
                - 码元传输速率
                    - 又称码元速率、波形速率等
                        - 单位时间内数字通信系统所传输的码元个数(也可称为脉冲个数或信号变化的次数)
                        - 单位是波特(Baud
                - 信息传输速率
                    - 又称信息速率、比特率等比特率 = 波特率 * log2 N，其中 波特率为 N 进制码元。计算机异步串行通信系统中，使用二进制编码，即 1bit = 1 baud。
                        - 单位时间内数字通信系统传输的二进制码元个数(即比特数)
                        - 单位是比特/秒(b/s)
        - 带宽
            - 带宽原指信号具有的频带宽度,单位是赫兹(Hz)。
                - 单位时间内从网络中的某一点到另一点所能通过的“最高数据率”。
                    - 单位不再是Hz,而是b/s
- 2.1.2 奈奎斯特定理与香农定理
    - 1. 奈奎斯特定理
        - 在理想低通(没有噪声、带宽有限)的信道中
        - 极限码元传输率为2W波特
            - 其中W是理想低通信道的带宽,单位为Hz。
                - 理想低通信道下的极限数据传输率=2W＊log2 V (单位为b/s)
                    - V表示每个码元离散电平的数目码元速率转换成比特速率
        - 结论
            - 1) 在任何信道中,码元传输的速率是有上限的。若传输速率超过此上限,就会出现严重的码间串扰问题(指在接收端收到的信号波形失去了码元之间的清晰界限),使得接收端不可能完全正确识别码元。
            - 2) 信道的频带越宽(即通过的信号高频分量越多),就可用更高的速率进行码元的有效传输。
            - 3) 奈氏准则给出了码元传输速率的限制,但并未对信息传输速率给出限制,即未对一个码元可以对应多少个二进制位给出限制。
    - 2. 香农定理
        - 带宽受限且有高斯白噪声干扰的信道的极限数据传输率
        - 信道的极限数据传输率=W＊log2(1+S/N) (单位为b/s)
            - W 为信道的带宽,S为信道所传输信号的平均功率,N为信道内部的高斯噪声功率。S/N 为信噪比,即信号的平均功率与噪声的平均功率之比,信噪比=10log10(S/N) (单位为dB),
        - 结论:
            - 1)信道的带宽或信道中的信噪比越大,信息的极限传输速率越高。
            - 2)对一定的传输带宽和一定的信噪比,信息传输速率的上限是确定的。
            - 3)只耍信息的传输速率低于信道的极限传输速率,就能找到某种方法来实现无差错的传输。
            - 4)香农定理得出的是极限信息传输速率,实际信道能达到的传输速率要比它低不少。
            - 一个码元对应的二进制位数是有限的。
- 2.1.3 编码与调制
    - 把数据变换为模拟信号的过程称为调制,把数据变换为数字信号的过程称为编码。
    - 1。数字数据编码为数字信号
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FxYxRRY4fuC.png?alt=media&token=0cf005e1-6e9c-4fcd-afd8-9bd90912a9c4)
        - (1)归零编码
            - 用高电平代表1、低电平代表0(或者相反)
            - 每个时钟周期的中间均跳变到低电平(归零),接收方根据该跳变调整本方的时钟基准,这就为传输双方提供了自同步机制。
            - 由于归零需要占用一部分带宽,因此传输效率受到了一定的影响。
        - (2)非归零编码
            - 与RZ编码的区别是不用归零,一个周期可以全部用来传输数据
            - 无法传递时钟信号,双方难以同步,因此若想传输高速同步数据,则需要都带有时钟线。
        - (3)反向非归零编码
            - 用信号的翻转代表0、信号保持不变代表1
            - 集成了前两种编码的优点,既能传输时钟信号,又能尽量不损失系统带宽。
            - USB2.0通信的编码方式就是NRI编码。
        - (4)曼彻斯特编码
            - 将一个码元分成两个相等的间隔,前一个间隔为高电平而后一个间隔为低电平表示码元1;码元0的表示方法则正好相反。
                - 也可采用相反的规定。
            - 在每个码元的中间出现电平跳变,位中间的跳变既作为时钟信号(可用于同步),又作为数据信号,但它所占的频带宽度是原始基带宽度的两倍。
            - 以太网使用的编码方式就是曼彻斯特编码
        - (5)差分曼彻斯特编码
            - 常于局域网传輪
            - 在每个码元的中间都有一次电平的跳转,可以实现自同步,且抗干扰性较好。
            - 若码元为1,则前半个码元的平与上码元的后半个码元的电平相同;若码元为0,则情形相反。
        - (6)4B/5B编码
            - 将欲发送数据流的每4位作为一组,然后按照4B/5B编码规则将其转换成相应的5位码。
            - 5 位码共32种组合,但只采用其中的16种对应16种不同的4位码,其他的16种作为控制码(帧的开始和结束、线路的状态信息等)或保留。
    - 2。数字数据调制为模拟信号
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F8wgFkvVq6A.png?alt=media&token=49d47d72-5126-4e1b-9da3-e9b1d373b386)
        - 幅移键控(ASK)
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FLfdOtVQwpV.png?alt=media&token=ff8e0402-9ea1-4e56-a37c-31d130453415)
            - 通过改变载波信号的振幅来表示数字信号1和0,而载波的频率和相位都不改变。
            - 比较容易实现,但抗千扰能力差。
        - 频移键控(FSK)
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FzOO99ZRBXY.png?alt=media&token=3e200808-83f1-4a40-a718-f76119b69460)
            - 通过改变载波信号的频率来表示数字信号1和0,而载波的振幅和相位都不改变。
            - 容易实现,抗干扰能力强,目前应用较为广泛
        - 相移键控(PSK)
            - 通过改变载波信号的相位来表示数字信号1和0,而载波的振幅和频率都不改变。
            - 它又分为绝对调相和相对调相
        - 正交振幅调制(QAM)
            - 在频率相同的前提下,将ASK与PSK结合起来,形成叠加信号
            - R=Blog2(mn) (单位为b/s)
                - 设波特率为B,采用m个相位,每个相位有n种振幅,则该QAM技术的数据传输率R
    - 3。模拟数据编码为数字信号
        - 常用于对音频信号进行编码的脉码调制(PCM)
        - 采样定理:在通信领域,带宽是指信号最高频率与最低频率之差,单位为Hz。因此,将模拟信号转换成数字信号时,假设原始信号中的最大频率为,那么采样频率 f采样 必须大于
            - 等于最大频率f 的两倍,才能保证采样后的数字信号完整保留原始模拟信号的信息
        - 采样
            - 采样是指对模拟信号进行周期性扫描,把时间上连续的信号变成时间上离散的信号。
                - 当采样的频率大于等于模拟数据的频带带宽(最高变化频率)的两倍时, 所得的离散信号可以无失真地代表被采样的模拟数据。
        - 量化
            - 量化是把采样取得的电平幅值按照一定的分级标度转化为对应的数字值并取整数,
        - 编码
            - 编码是把量化的结果转换为与之对应的二进制编码。
    - 4。模拟数据调制为模拟信号
        - 为了实现传输的有效性,可能需要较高的频率
        - 还可以使用频分复用(FDM) 技术,充分利用带宽资源
        - 电话机和本地局交换机采用模拟信号传输模拟数据的编码方式;模拟的声音数据是加载到模拟的载波信号中传输的。
- 2.1.4 电路交换、报文交换与分组交换
    - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2Fc1SS6IO3EV.png?alt=media&token=fffb2ef9-8e3d-4c38-bb6f-091bea1657c0)
    - 1。电路交換
        - 在进行数据传输前,两个结点之间必须先建立一条专用(双方独占)的物理通信路径(由通信双方之间的交换设备和链路逐段连接而成),该路径可能经过许多中间结点。
            - 电路上的任何结点都采取“直通方式”接收数据和发送数据,即不会存在存備转发所耗费的时
        - 三个阶段
            - 连接建立
            - 数据传输
            - 连接释放。
        - 优点如下
            - 通信时延小
                - 由于通信线路为通信双方用户专用,数据直达,因此传输数据的时延非常小。当传输的数据量较大时,这一优点非常明显
            - 有序传输
                - 双方通信时按发送顺序传送数据,不存在失序问题。
            - 没有冲突
                - 不同的通信双方拥有不同的信道,不会出现争用物理信道的问题。
            - 适用范围广
                - 电路交换既适用于传输模拟信号,又适用于传输数字信号。
            - 实时性强
                - 通信双方之间的物理通路一旦建立,双方就可以随时通信。
            - 控制简单
                - 电路交换的交换设备(交换机等)及控制均较简单。
        - 缺点如下
            - 建立连接时间长
                - 电路交换的平均连接建立时间对计算机通信来说太长。
            - 线路独占,使用效率低
                - 电路交换连接建立后,物理通路被通信双方独占,即使通信线路空闲,也不能供其他用户使用,因而信道利用率低。
            - 灵活性差
                - 只要在通信双方建立的通路中的任何一点出了故障,就必须重新拨号建立新的连接,这对十分紧急和重要的通信是很不利的。
            - 难以规格化
                - 电路交换时,数据直达,不同类型、不同规格、不同速率的终端很难相互进行通信,也难以在通信过程中进行差错控制。
    - 2。报文交换
        - 数据交换的单位是报文,报文携带有目标地址、源地址等信息。
        - 报文交换在交换结点采用的是存储转发的传输方式。
        - 优点如下
            - 无须建立连接
                - 报文交换不需要为通信双方预先建立一条专用的通信线路,不存在建立连接时延,用户可以随时发送报文。
            - 动态分配线路
                - 当发送方把报文交给交换设备时,交换设备先存储整个报文,然后选择一条合适的空闲线路,将报文发送出去。
            - 提高线路可靠性
                - 如果某条传输路径发生故障,那么可重新选择另一条路径传输数据, 因此提高了传输的可靠性。
            - 提高线路利用卒
                - 通信双方不是固定占有一条通信线路,而是在不同的时间一段一段地部分占有这条物理通道,因而大大提高了通信线路的利用率
            - 提供多目标服务
                - 一个报文可以同时发送给多个目的地址,这在电路交换中是很难实现的。
        - 缺点如下
            - 由于数据进入交换结点后要经历存储、转发这一过程,因此会引起转发时延(包括接收报文、检验正确性、排队、发送时间等)。
            - 报文交换对报文的大小没有限制,这就要求网络结点需要有较大的缓存空间。
        - 主要使用在早期的电报通信网中,现在较少使用,通常被较先进的分组交换方式所取代
    - 3。分组交换
        - 同报文交换一样,分组交换也采用存储转发方式,
        - 解决了报文交换中大报文传输的问题。
        - 交换限制了每次传送的数据块大小的上限,把大的数据块划分为合理的小数据块,再加上些必要的控制信息(如源地址、目的地址和编号信息等),构成分组( Packet)。
        - 网络结点根据控制信息把分组送到下一结点,下一结点接收到分组后,暂时保存并排队等待传输,然后根据分组控制信息选择它的下一个结点,直到到达目的结点。
        - 优点如下
            - 无建立时延
                - 不需要为通信双方预先建立一条专用的通信线路,不存在连接建立时延用户可随时发送分组。
            - 线路利用率高
                - 通信双方不是固定占有一条通信线路,而是在不同的时间一段一段地部分占有这条物理通路,因而大大提高了通信线路的利用率
            - 简化了存储管理
                - 因为分组的长度固定,相应的缓冲区的大小也固定, 在交换结点中存储器的管理通常被简化为对缓冲区的管理,相对比较容易。
            - 加速传输
                - 分组是逐个传输的,可以使后一个分组的存储操作与前一个分组的转发操作并行,这种流水线方式减少了报文的传输时间。
                - 传输一个分组所需的缓冲区比传输次报文所需的缓冲区小得多,这样因缓冲区不足而等待发送的概率及时间也必然少得多。
            - 减少了出错概率和重发数据量
                - 因为分组较短,其出错概率必然减小,所以每次重发的数据量也就大大减少,这样不仅提高了可靠性,也减少了传输时延。
        - 缺点如下
            - 存在传输时延
                - 尽管分组交换比报文交换的传输时延少,但相对于电路交换仍存在存储转发时延,而且其结点交换机必须具有更强的处理能力。
            - 需要传输额外的信息量
                - 每个小数据块都要加上源地址、目的地址和分组编号等信息, 从而构成分组,因此使得传送的信息量增大了5%~10%,一定程度上降低了通信效率, 增加了处理的时间,使控制复杂,时延增加。
            - 当分组交换采用数据报服务时,可能会出现失序、丢失或重复分组
                - 分组到达目的结点时,要对分组按编号进行排序等工作,因此很麻烦
                - 若采用虚电路服务,虽无失序问题, 但有呼叫建立、数据传输和虚电路释放三个过程。
- 2.1.5 数据报与虚电路
    - 分组交换根据其通信子网向端点系统提供的服务,还可进一步分为面向连接的虚电路方式和无连接的数据报方式。
    - 这两种服务方式都由网络层提供
    - 要注意数据报方式和虚电路方式是分组交换的两种方式
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FNtH4nx3w0u.png?alt=media&token=8ae2ed6d-fcf9-497a-b5d2-890060f932f6)
        - 1。数据报
            - 端系统发送一个报文时,高层协议先把报文拆成若干带有序号的数据单元,并在网络层加上地址等控制信息后形成数据报分组(即网络层PDU)。
            - 间结点存储分组很短一段时间,找到最佳的路由后,尽快转发每个分组。
            - 不同的分组可以走不同的路径,也可以按不同的顺序到达目的结点
            - 特点:
                - 发送分组前不需要建立连接。发送方可随时发送分组,网络中的结点可随时接收分组。
                - 发送的分组中要包括发送端和接收端的完整地址,以便可以独立传输。
                - 网络尽最大努力交付,传输不保证可靠性,所以可能丢失，可靠性由用户保证;
                - 为每个分组独立地选择路由, 转发的路径可能不同,因而分组不一定按序到达目的结点。
                - 分组在交换结点存储转发时,需要排队等候处理,这会带来一定的时延。
                    - 通过交换结点的通信量较大或网络发生拥塞时,这种时延会大大增加,交换结点还可根据情况丢弃部分分组。
                - 网络具有冗余路径
                    - 当某一交换结点或一段链路出现故障时,可相应地更新转发表,寻找另一条路径转发分组,对故障的适应能力强。
                - 存储转发的延时一般较小,提高了网络的吞吐量
                - 收发双方不独占某一链路,资源利用率较高。
                - 适用于突发通讯，不适用于长报文、会话式通讯。
                - 由用户主机进行流量控制，不保证数据包的可靠性。
                - 
        - 2。虚电路
            - 在分组发送之前,要求在发送方和接收方建立一条逻辑上相连的虚电路,
                - 并且连接一旦建立,就固定了虚电路所对应的物理路径
            - 三个阶段:
                - 三个阶段:虚电路建立、数据传输与虚电路释放。
                    - 建立虚电路时,选择一个未用过的虚电路号分配给该虚电路以区别于本系统中的其他虚电路。
                    - 在传送数据时,每个数据分组不仅要有分组号、校验和等控制信息,还要有它要通过的虚电路号,以区别于其他虚电路上的分组。
                    - 在虚电路网络中的每个结点上都维持一张虚电路表,表中的每项记录了一个打开的虚电路的信息,包括在接收链路和发送链路上的虚电路号、前一结点和下一结点的标识。
            - 特点：
                - 必须建立链接
                - 仅在建立连接阶段使用，每个分组使用长度较短的虚电路号
                - 属于同一条虚电路的分组按照同一路由转发
                - 保证分组有序到达
                - 可靠性由网络保证
                - 所有经过故障结点的虚电路都不能正常工作
                - 可由分组交换网负责，也可由用户主机负责
- 2.1.6 通讯方式和传输方式
    - 通讯方式
        - 单工通讯
            - 只有一个方向的通讯而没有放方向的交互，仅需要一条通道
        - 半双工
            - 通讯双方都可以发送或者接收信息，但任何一方都不能同时发送和接收，需要两条信道
        - 全双工
            - 通讯双方可以同时发送和接收信息，需要两条信道
    - 串行传输 & 并行传输
        - 串行传输
            - 将表示一个字符的8位二进制数按由低位到高位的顺序依次发送
            - 速度慢,费用低,适合远距离
        - 并行传输
            - 将表示一个字符的8位二进制数同时通过8条信道发送，线路太宽
            - 用于计算机内部数据传输
            - 速度快,费用高,适合近距离
    - 同步传输 & 异步传输
        - 同步传输
            - 在同步传输的模式下,数据的传送是以一个数据区块为单位,因此同步传输又称为区块传输
            - 在传送数据时,需先送出1个或多个同步字符,再送出整批的数据
        - 异步传输
            - 异步传输将比特分成小组进行传送,小组可以是8位的1个字符或更长。发送方可以在任何时刻发送这些比特组,而接收方不知道它们会在什么时候到达
            - 传送数据时,加一个字符起始位和一个字符终止位

### 2.2 传输介质

- 2.2.1 双絞线、同轴电缆、光纤与无线传输介质
    - 传输介质也称传输媒体,它是发送设备和接收设备之间的物理通路。
    - 传输介质可分为导向传输介质和非导向传输介质。
        - 在导向传输介质中,电磁波被导向沿着固体媒介(铜线或光纤)传播
        - 导向传输介质可以是空气、真空或海水等。
    - 1。双绞线
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F8uPt9ZPFha.png?alt=media&token=982959a0-32a2-4536-ae61-5445ea3d4271)
        - 古老传输介质,它由两根采用一定规则并排绞合的、相互绝缘的铜导线组成。
        - 绞合可以减少对相邻导线的电磁干扰。
        - 屏蔽双绞线(STP)。
            - 在双绞线的外面再加上一个由金属丝编织成的屏蔽层
        - 非屏蔽双绞线(UTP)
            - 无屏蔽层的双绞线
        - 带宽取决于铜线的粗细和传输的距离
        - 距离
            - 几千米到数十千米
            - 距离太远时
                - 模拟传输,要用放大器放大衰减的信号
                - 数字传输, 要用中继器将失真的信号整形。
        - 优点
            - 双绞线价格便宜
            - 适用范围广
                - 局域网和传统电话网中普遍使用
                - 模拟传输和数字传输
    - 2。同轴电缆
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F2TI72yYUVD.png?alt=media&token=77a1984e-e23a-4e43-bf23-ae40bd329757)
        - 由内导体、绝缘层、网状编织屏蔽层和塑料外层构成
        - 按特性阻抗数值的不同,
            - 50欧姆 同轴电缆主要用于传送基带数字信号,又称基带同轴电缆
                - 它在局域网中应用广泛
            - 75欧姆 同轴电缆主要用于传送宽带信号,又称宽带同轴电缆,
                - 主要用于有线电视系统。
            - 优点
                - 良好的抗干扰特性
                - 广泛用于传输较高速率的数据,
                - 传输距离更远
            - 缺点
                - 价格较双绞线贵
    - 3。光纤
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FFO4uY7eMWj.png?alt=media&token=897f92a4-336d-44c1-81d9-ef323a2efbec)
        - 由纤心和包层构成,光波通过纤心进行传导,包层较纤心有较低的折射率
        - 光纤传输
            - 利用光导纤维(简称光纤)传递光脉冲来进行通信。
            - 全反射
                - 当光线从高折射率的介质射向低折射率的介质时,其折射角大于入射角。
                - 只要从纤心中射到纤心表面的光线的入射角大于某个临界角度,就会产生全反射
        - 多模光纤
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FJtfslCDk39.png?alt=media&token=5fe8b483-cbe1-49c2-bcd5-441447da84bc)
            - 从不同角度入射的多束光线可在一条光纤中传输,
            - 光源为发光二极管
            - 光脉冲在多模光纤中传输时会逐渐展宽,造成失真,因此多模光纤只适合于近距离传输。
        - 单模光纤
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F6DQBPsu0Ti.png?alt=media&token=c176f631-0659-498b-b2c5-037b1ae6816a)
            - 光纤的直径减小到仅一个光波长度时,光纤就像一根波导那样,可使光线一直向前传播,而不会产生多次反射
            - 纤心很细,直径只有几微米,制造成本较高
            - 光源为定向性很好的激光二极管
                - 单模光纤的衰减狡小,合远地传输
    - 4。无线传输介质
        - 无线电波
            - 无线电波具有较强的穿透能力,可以传输很长的距离,所以它被广泛应用于通信领域
            - 因为无线电波使信号向所有方向散播, 因此有效距离范围内的接收设备无须对准某个方向,就可与无线电波发射者进行通信连接,大大简化了通信连接。
        - 徽波、红外线和激光
            - 相同点
                - 都需要发送方和接收方之间存在一条视线(Line-of- sight)通路,有很强的方向性,都沿直线传播,有时统称这三者为视线介质。
            - 不同点
                - 红外通信和激光通信把要传输的信号分别转换为各自的信号格式,即红外光信号和激光信号,再直接在空间中传播。
                - 微波通信的频率较高,频段范围也很宽,载波频率通常为2~40GHz,因而通信信道的容量大。
                - 微波通信的信号是沿直线传播的,因此在地面的传播距离有限,超过一定距离后就要用中继站来接力。
        - 卫星通信
            - 利用地球同步卫星作为中继来转发微波信号,可以克服地面微波通信距离的限制。
            - 优点
                - 优点是通信容量大、距离远、覆盖广
            - 缺点
                - 缺点是端到端传播时延长,一般为250~270ms。
- 2.2.2 物理层接口的特性
    - 机械特性
        - 主要定义物理连接的边界点,即接插装置。规定物理连接时所采用的规格、引线的数目、引脚的数量和排列情况等。
    - 电气特性
        - 规定传输二进制位时,线路上信号的电压高低、阻抗匹配、传输速率和距离限制等
    - 功能特性
        - 指明某条线上出现的某一电平的电压表示何种意义,接口部件的信号线(数据线、控制线、定时线等)的用途。
    - 规程特性
        - 主要定义各条物理线路的工作规程和时序关系。
    - 常用的物理层接口标准有 EIA RS-232-C、ADSL和 SONET/SDH等

### 2.3 物理层设备

- 2.3.1 中继器
    - 功能
        - 主要功能是将信号整形并放大再转发出去,以消除信号经过一长段电缆后,因噪声或其他原因而造成的失真和衰减,使信号的波形和强度达到所需要的要求,进而扩大网络传输的距离。
    - 原理
        - 原理是信号再生
            - 中继器放大的是数字信号,原理是将衰减的信号整形再生
    - 优点
        - 是局域网环境下用来扩大网络规模的最简单、最廉价的互联设备。
    - 缺点
        - 若出现故障,对相邻两个网段的工作都将产生影响。
        - 不能连接两个具有不同速率的局域网。
    - 工作在物理层
        - 端口仅作用于信号的电气部分,而不管数据中是否有错误数据或不适于网段的数据
        - 中继器两端的网络部分是网段,而不是子网
        - 连接的几个网段仍然是一个局域网。
        - 没有存储转发功能的
            - 不能连接两个具有不同速率的局域网。
            - 中继器两端的网段一定要使用同一个协议
    - 5-4-3规则”
        - 互相串联的中继器的个数不能超过4个,而且用4个中继器串联的5段通信介质中只有3段可以挂接计算机, 其余两段只能用作扩展通信范围的链路段,
    - 放大器
        - 放大的是模拟信号
            - 原理是将衰减的信号放大
- 2.3.2 集线器
    - 功能
        - 实质上是一个多端口的中继器,它也工作在物理层
        - 一个端口接收到数据信号后,因为传输过程中已有衰减,所以整形放大,紧接着转发到其他所有(除输入端口外)处于工作状态的端口
        - 如果同时有两个或多个端口输入,那么输出时会发生冲突,致使这些数据都无效。
        - 目的是扩大网络的传输范围,
    - 优点
        - 目的是扩大网络的传输范围,
        - 是从服务器连接到桌面的最经济方案
    - 缺点
        - 不具备信号的定向传送能力,即信号传输的方向是固定的,
        - 是共享式网络,但逻辑上仍是一个总线网
        - 能在半双工状态下工作．
        - 吞吐率受到限制
        - 不能分割冲突域
            - 所有集线器的端ロ都属于同一个冲突域
        - 多台机器经常需要同时通信,那么将导致信息碰撞,使得集线器的工作效率很差

<div style="page-break-after:always;"></div>

## 第三章 数据链路层

### 3.1 数据链路层的功能

- 加强物理层传输原始比特流的功能,将物理层提供的可能出错的物理连接改造为逻辑上无差错的数据链路,使之对网络层表现为一条无差错的链路。下面具体介绍数据链路层的功能。
- 3.1.1为网络层提供服务
    - 无确认的无连接服务
        - 源机器发送数据帧时不需先建立链路连接,目的机器收到数据帧时不需发回确认。
        - 对丢失的帧,数据链路层不负责重发而交给上层处理。
        - 适用于实时通信或误码率较低的通信信道,如以太网。
    - 有确认的无连接服务
        - 源机器发送数据帧时不需先建立链路连接,但目的机器收到数据帧时必须发回确认。
        - 源机器在所规定的时间内未收到确定信号时,就重传丢失的帧,以提高传输的可靠性。
        - 该服务适用于误码率较高的通信信道,如无线通信。
    - 有确认的面向连接服务
        - 帧传输过程分为三个阶段:建立数据链路、传输帧、释放数据链路。
        - 目的机器对收到的每一帧都要给出确认,源机器收到确认后オ能发送下一帧,因而该服务的可靠性最高。
        - 该服务适用于通信要求(可靠性、实时性)较高的场合。
    - 有连接就一定要有确认,即不存在无确认的面向连接的服务。
- 3.1.2链路管理
    - 数据链路层连接的建立、维持和释放过程称为链路管理,它主要用于面向连接的服务。
    - 过程
        - 首先确认对方已处于就绪状态,
        - 并交换一些必要的信息以对帧序号初始化,
        - 建立连接,在传输过程中则要能维持连接,
        - 传输完毕后要释放该连接。
    - 在多个站点共享同一物理信道的情况下(例如在局域网中)如何在要求通信的站点间分配和管理信道也属于数据链路层管理的范畴。
- 3.1.3帧定界、帧同步与透明传输
    - 两个工作站之间传输信息时,必须将网络层的分组封装成帧,以帧的格式进行传送
    - 将一段数据的前后分别添加首部和尾部,就构成了帧。
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F7R-bfC47eM.png?alt=media&token=ad260475-97ea-42ba-b531-0cc9783f9487)
        - 帧定界。
            - 首部和尾部中含有很多控制信息,它们的一个重要作用是确定帧的界限,即帧定界。
        - 帧同步
            - 帧同步指的是接收方应能从接收到的二进制比特流中区分出帧的起始与终止。
        - 透明传输
            - 采取有效的措施解决误认为“传输结東”而丢弃后面的数据的问题,即透明传输。不管所传数据是什么样的比特组合,都应当能在链路上传送。
- 3.1.4流量控制
    - 流量控制实际上就是限制发送方的数据流量,使其发送速率不超过接收方的接收能力。
    - 通过某种反馈机制使发送方能够知道接收方是否能跟上自己,即需要有一些规则使得发送方知道在什么情况下可以接着发送下一帧,而在什么情况下必须暂停发送,以等待收到某种反馈信息后继续发送。
    - 并不是数据链路层特有的功能
        - 对于数据链路层来说,控制的是相邻两结点之间数据链路上的流量,
        - 对于运输层来说,控制的则是从源端到目的端之间的流量。
- 3.1.5差错控制
    - 用以使发送方确定接收方是否正确收到由其发送的数据的方法称为差错控制。
    - 通常,这些错误可分为位错和帧错。
        - 位错
            - 位错指帧中某些位出现了差错。
                - 通常采用循环冗余校验(CRC)方式发现位错,通过自动重传请求( Automatic Repeat request,ARQ)方式来重传出错的幀。
                    - ARQ法只需返回很少的控制信息就可有效地确认所发数据帧是否被正确接收。
        - 帧错
            - 帧错指帧的丢失、重复或失序等错误。
            - 在数据链路层引入定时器和编号机制,能保证每一帧最终都能有且仅有一次正确地交付给目的结点。

### 3.2 组帧

- 目的
    - 为了在出错时只重发出错的帧,而不必 重发全部数据,从而提高效率。
    - 为了使接收方能正确地接收并检查所传输的帧,发送方必须依据 一定的规则把网络层递交的分组封装成帧(称为组帧)。
- 解决的问题
    - 帧定界
        - 组帧时既要加首部,又要加尾部。原因是,在网络中信息是以帧为最小单位进行传输 的,所以接收端要正确地接收帧,必须要清楚该帧在一串比特流中从哪里开始到哪里结束(因为 接收端收到的是一串比特流,没有首部和尾部是不能正确区分帧的)。而分组(即IP数据报)仅 是包含在帧中的数据部分(后面将详细讲解),所以不需要加尾部来定界。
    - 帧同步
    - 透明传输
- 四种方法
    - 3.2.1 字符计数法
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FB5qcxjwfCz.png?alt=media&token=a0b185dc-0961-4837-a7cc-a8fb299a70f5)
        - 在帧头部使用一个计数字段来标明帧内字符数。
        - 缺点
            - 如果计数字段出错,即失去了帧边界划分的依据,那么接收方就无 法判断所传输帧的结束位和下一帧的开始位,收发双方将失去同步,从而造成灾难性后果。
    - 3.2.2 字符填充的首尾定界符法
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FWHbAeglc8X.png?alt=media&token=b202c6e8-b9ae-4320-95f9-508ca8d47bc9)
        - 使用一些特定的字符来定界一帧的开始(DLE STX)与结束(DLEETX)。
        - 在特殊字符前面填充一个转义字符 (DLE)来加以区分
    - 3.2.3 零比特填充的首尾标志法
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FgfrtKNwr6n.png?alt=media&token=5c1e3a2f-723f-4da3-92c8-83e57db63358)
        - 使用一个特定的比特模式,即01111110来标志一帧的开始和结束。
        - 发送方的数据链路层在信息位中遇到5 个连续的“广时,将自动在其后插入一个“0七而接收方做该过程的逆操作,即每收到5个连 续的“1"时,自动删除后面紧跟的“0七以恢复原信息。
        - 零比特填充法很容易由硬件来实现,性能优于字符填充法。
    - 324违规编码法
        - 物理层进行比特编码时,通常采用违规编码法。
        - 借用这些违规编码序列来定界帧的起始和终止。
        - 局域网IEEE 802标准就采用了这种方法。
        - 只适用于采用冗余 编码的特殊编码环境。
    - 目前较常用 的组帧方法是比特填充法和违规编码法
    
- 3.3 差错控制
    - 影响因素：信道固有噪声干扰
      
        - 解决方法：提高信噪比
    - 外界的冲击噪声是产生差错的重要原因
      
        - 没有办法通过提高信号幅度来降低干扰
    - 利用编码技术
        - 自动重传请求ARQ
          
            - 接收端检测出差错时,就设法通知发送端重发,直到接收到正确的码字为止。
        - 前向纠错FEC
          
            - 接收端不但能发现差错,而且能确定比特串的错误位置,从而加以纠正。
        - 3.3.1 检错编码
            - 检错编码都采用冗余编码技术
              
                - 附加一定的冗余位,构成一个符合某一规则的码字后再发送。当要发送的有效数据变化时,相 应的冗余位也随之变化,使得码字遵从不变的规则。接收端根据收到的码字是否仍符合原规则来 判断是否出错。
            - 1. 奇偶校验码
                - 由 n-1 位信息元和 1 位校验元组成
                - 奇校验码
                    - 奇校验码,那么在附加一个校验元后,码长为n的码字中“1”的个数为 奇数;
                - 偶校验码
                    - 偶校验码,那么在附加一个校验元以后,码长为n的码字中“1”的个数为偶数。 
            - 2. 循环冗余码
                - 又称多项式码
                - 任何一个由二进制数位串组成的代码都可以与一个只含有0和1两个系数的多项式建立一一对应关系。
                    - 如: 1110011有7位,表示成多项式是 X^6+X^5+X^4+X+1,而多项式 X^5+X^4+X^2+X 对应的位串是 11011
                - 给定一个 m bit的帧或报文,发送器生成一个 r bit 的序列,称为帧检验序列(FCS)
                - 运算过程
                    - 发送方和接收方事先商定一个多项式G(x)(最高位和最低位必须为1)
                    - 帧有m位,其对应的多项式为M(x)
                    - 加0。假设G(x)的阶为 r,在帧的低位端加上 r 个0。
                    - 模2除。利用模2除法,用G(x)对应的数据串去除上一步计算出的数据串,得到的余数即为冗余码(共 r 位,前面的0不可省略)。
                        - 以2为模运算，刚好是异或操作。
                    - 计算举例:
                        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FWqGPwrCeQy.png?alt=media&token=b3db106a-477d-4ffa-a97b-fbf8c93f12fd)
                        - 设G(x) = 1101 (即 r = 3）
                        - 传送数据 M = 101001 (即 m= 6
                        - 被除数一共 m+r 位：101001 + 000
                        - 经模2 除法运算后的结果是:商0=110101 (这个商没什么用),余数 R = 001。
                        - 送出去的数据为 101001 001 (即 2^r * W + FCS),共有m + r位。
        - 3.3.2 纠错编码
            - 解决差错问题的一种方法是在每个要发送的数据块上附加足够的冗余 信息,使接收方能够推导出发送方实际送出的应该是什么样的比特串。
            - 海明码
                - 原理
                    - 在有效信息位中加入几个校验位形成海明码,并把海明码的每个二进制位分配 到几个奇偶校验组中。
                    - 当某一位出错后,就会引起有关的几个校验位的值发生变化,这不但可以 发现错位,而且能指出错位的位置,为自动纠错提供依据。
                - 计算步骤
                    - (1) 确定海明码的位数
                        - 设 n 为有效信息的位数,k 为校验位的位数,则信息位 n 和校验位 k 应满足 n+k < 2^k - 1 (若要检测两位错,则需再增加1位校验位,即 k+1 位)
                    - (2) 确定校验位的分布
                        - 规定校验位 Pi 在海明位号为 2^(i-1) 的位置上,其余各位为信息位
                            - P1 的海明位号为 2^(i-1)=2^0=1, 即 H1 为 P1。
                            - P2 的海明位号为 2^(i-1)=2^1=1, 即 H2 为 P2。
                            - P3 的海明位号为 2^(i-1)=2^2=4, 即 H4 为 P3。
                    - (3) 分组以形成校验关系
                        - 每个数据位用多个校验位进行校验
                            - 满足条件:被校验数据位的海明位号等于校验该数 据位的各校验位海明位号之和。
                        - 校验位不需要再被校验。
                        - Subtopic
                            - Index(D)  = Sum( Index (P) )
                                - D1 放在 H3 上, 由 P2 P1 校验:
                                    - 3 = 2^(2-1) + 2^(1-1)
                                - D2 放在 H5 上, 由 P3 P1 校验:
                                    - 5 = 2^(3-1) + 2^(1-1)
                                - D3 放在 H6 上, 由 P3 P2 校验:
                                    - 6 = 2^(3-1) + 2^(2-1)
                                - D4 放在 H7 上, 由 P3 P2 P1 校验:
                                    - 7 = 2^(3-1) + 2^(2-1) + 2^(1-1)
                    - (4) 校验位取值
                        - 校验位 Pi 的值为第i组(由该校验位校验的数据位)所有位求异或。
                        - Subtopic
                        - 1010 对应的海明码为1010010
                    - (5) 海明码的校验原理
                        - 每个校验组分别利用校验位和参与形成该校验位的信息位进行奇偶校验检查,构成 k 个校验 方程:
                        - 若S3S2S1的值为“000”,则说明无错;否则说明出错,且这个数就是错误位的位号,如S3S2S1 = 001 说明第1位出错,即0出错,直接将该位取反就达到了纠错的目的。
                - “纠错”与“检错”
                    - 有定理 D + C = L - 1 (D >= C)
                        - D 表示检错长度；
                        - C 表示纠错长度；
                        - L表示编码长度此定理来源于信息论，只需记住结论。
                    - 当有 C 位纠错时，至少有 C 位检错，此时 L = 2C+1
                    - 当有 D 位检错时，则纠错位长度可为 0 （只检错不纠错），此时 L = D + 1

### 3.4 流量控制与可靠传输机制

- 3.4.1 流量控制、可靠传输与滑动窗口机制
  
    - 流量控制涉及对链路上的帧的发送速率的控制,以使接收方有足够的缓冲空间来接收每个 帧。
    - 1. 停止-等待流量控制基本原理
        - 发送方每发送一帧,都要等待接收方的应答信号,之后才能发送下一帧;
        - 收方每接收一帧, 都要反馈一个应答信号,表示可接收下一帧,如果接收方不反馈应答信号,那么发送方必须一直 等待。
        - 每次只允许发送一帧,然后就陷入等待接收方确认信息的过程中,因而传输效率很低。
    - 2. 滑动窗口流量控制基本原理
        - 概述
            - 在任意时刻,发送方都维持一组连续的允许发送的帧的序号,称为发送窗口;同时接收方也 维持一组连续的允许接收帧的序号,称为接收窗口。
            - 发送窗口用来对发送方进行流量控制,而发 送窗口的大小 WT 代表在还未收到对方确认信息的情况下发送方最多还可以发送多少个数据帧。
            - 在接收端设置接收窗口是为了控制可以接收哪些数据帧和不可以接收哪些帧。
            - 接收方, 只有收到的数据帧的序号落入接收窗口内时,才允许将该数据帧收下。若接收到的数据帧落在接 收窗口之外,则一律将其丢弃。
        - 发送和接收的处理
            - 发送端每收到一个确认帧,发送窗口就向前滑动一个帧的位置,当发送窗口内没有可以发送 的帧(即窗口内的帧全部是已发送但未收到确认的帧)时,发送方就会停止发送,直到收到接收 方发送的确认帧使窗口移动,窗口内有可以发送的帧后,才开始继续发送。
            - 接收端收到数据帧后,将窗口向前移一个位置,并发回确认帧,若收到的数据帧落在接收窗 口之外,则一律丢弃。
        - 重要特性:
            - 1) 只有接收窗口向前滑动(同时接收方发送了确认帧)时,发送窗口才有可能(只有发送 方收到确认帧后才一定)向前滑动。
            - 2)  从滑动窗口的概念看,停止-等待协议、后退N帧协议和选择重传协议只在发送窗口大小 与接收窗口大小上有所差别:
                - 停止-等待协议:发送窗口大小=1,接收窗口大小=1。
                - 后退N帧协议:发送窗口大小 > 1, 接收窗口大小=l
                - 选择重传协议:发送窗口大小 > 1,接收窗口大小 > 1。
            - 3)  接收窗口的大小为1时,可保证帧的有序接收。
            - 4)  数据链路层的滑动窗口协议中,窗口的大小在传输过程中是固定的
    - 3. 可靠传输机制
        - 使用确认和超时重传两种机制来完成。
            - 确认
                - 确认是一种无数据的控制 帧;这种控制帧使得接收方可以让发送方知道哪些内容被正确接收。
            - 超时重传
                - 超时重传是指发送方在发送某个数据帧后就开 启一个计时器,在一定时间内如果没有得到发送的数据帧的确认帧,那么就重新发送该数据帧, 直到发送成功为止。
        - 自动重传请求.( Auto Repeat reQuest, ARQ) 通过接收方请求发送方重传出错的数据帧来恢 复出错的帧,是通信中用于处理信道所带来差错的方法之一。
- 3.4.2单帧滑动窗口与停止、等待协议
    - 停止-等待协议:发送窗口大小=1,接收窗口大小=1。
    - 简单过程
        - 发送方过程
            - 连续出现相同序号的确认帧时,表明接收端收到了重复帧。帧序号以0和1交替；
            - 发送帧后等待 ACK （此接收的ACK为期望发送的ACK序号）；
            - 若 ACK 序号 = 1 - 发送序号，则删除上一个帧的副本，发送下一个，保留发送帧的副本，启动超时计时器；
            - 若 超时，则把副本重新发送一遍，重新计时。
        - 接收方过程
            - 接收帧，检查是否出错，
            - 无错，则上交，发送下一个期望收到的 ACK
            - 有错，则抛弃。
    - 帧缓冲区
        - 超时重发和判定重复帧的需要
- 3.4.3 多帧滑动窗口与后退N帧协议(GBN)
    - 后退N帧协议:发送窗口大小 > 1, 接收窗口大小=l
    - 若采用 n 比特对帧编号,则其发 送窗口的尺寸 WT 应满足 1 <= WT <= 2^n - 1。
    - 特点
        - 发送方无须在收到上一个帧的ACK后才能开始发送下一帧,而是可以连续发送帧。
        - 接收方只允许按顺序接收帧。
            - 当接收方检测出失序的信息帧后,要求发送方重发最后一个正确接收的信息帧之后的所有未被确认的帧;
            - 前一个帧在计时器超时后仍未返回其确认信息,则该帧被判为出错或丢失,此时发送方就重传该出错帧及随后的个帧。换句话说,接收方只允许按顺序接收帧。
    - 优点
      
        - 提高了信道的利用率
    - 缺点
      
        - 重传时，效率低。若信道的传输质量很差导致误码率较大时, 后退N帧协议不一定优于停止-等待协议。
    - 过程
        - 发送者
            - 响应三个事件：
                - 1. 上层要发送数据调用时
                    - 如果发送窗口未满，则接收数据，分配一个帧序号给新产生的帧，发送帧，缓存此帧，同时设置超时时钟
                    - 如果发送窗口已满，则通知上层窗口已满。
                - 2. 收到了来自接收者的 ACKn 
                    - 如果 n 大于发送窗口内的最小帧序号，则发送窗口向前移动至 n+1 ～ n+WT
                    - 否则，没有任何有效信息
                - 3. 超时时钟触发
                    - 重新发送超时的帧和其之后的所有帧，重置超时时钟。
            - 发送方的 ACKn 表示前n个均正确接收
        - 接收者
            - 当接收者此时的窗口序号为 n 时
            - 1. 若接收到序号为 x == n 的帧，检测无误后，上交到上层，接收窗口向后移动一位，发送 ACKn+1；有误，丢弃。
            - 2. 若接收到序号为 x != n 的帧，丢弃。
- 3.4.4 多帧滑动窗口与选择重传协议(SR)
    - 选择重传协议:发送窗口大小 > 1,接收窗口大小 > 1。
    - 只重传出现差错的数据帧或计时器超时的数据帧,
    - 必须加大接收窗口,以便先收下发送序号不连续1但仍处在接收窗口中的那些数据帧。
        - 接收窗口 WR + 发送窗口 WT <= 2^n接收窗口 WR 显然不应超过发送窗口 WT. WR <= WTWR <= 2^(n-1)。
        - 接收窗口为最大值时, WTmax = WRmax = 2^(n-1)
    - 所需缓冲区的数目等于窗口的大小,
    - 过程
        - 发送者
            - 1. 上层调用
                - 如果发送窗口未满，则接收数据，分配一个帧序号给新产生的帧，发送帧，缓存此帧，同时设置超时时钟；
                - 如果发送窗口已满，则通知上层窗口已满或缓存数据。
            - 2. 收到 ACKn
                - 如果 n 处于发送窗口范围内，则标记 n 号帧为已接收。
                    - 若 n 为发送窗口最小序号，则窗口向前移至最小的未确认帧处，并发送帧（若已经发送则等待）。
                - 如果 n 处于发送窗口外，则丢弃。
            - 3. 超时处理
                - 每个已经发送的帧都有超时时钟。时钟触发，则重新发送对应的一个帧。
        - 接收者
            - 当接受到的帧序号为 x 时，且接受窗口为 [n,n + WR]
            - 若帧序号为 x 的帧坏了，则发送 n 的 NAK。
            - 若 x != n , 则：
                - 发送 n 的 NAK；
                - 判断 x 是否在接受窗口内，
                    - 若在接受窗口内且序号为 n 的帧未收到，则标记为已收到，且缓存此帧，而不交付上一层。
                    - 若不在接受窗口内，且 x < n, 则重新检查 x，并返回 ACKx。
                    - 若不在接受窗口内，且 x > n + WR, 则丢弃。		
            - 若 x == n , 则：
                - 接受此帧，并且此序号以及之后已经缓存的连续序号的帧被交付到上一层，接收窗口向前移动到最小的未被交付的序号。
- 性能分析
    - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FfxPrX0vFaR.png?alt=media&token=caa49be9-1068-4f30-b36e-c82269a8d409)
    - T = 帧发送时间 + 重传时间  = 2 * 传播时延 + 确实帧发送时间 + 2 * 帧处理时间 + 帧发送时间
        - 发送方从开始发送数据到收到第一个确认帧ACK为止，这段时间称为一个发送周期
    - 信道利用率=发送时间/发送周期 = (发送比特/发送速率)/发送周期
    - 信道吞吐率=信道利用率*发送方的发送速率

### 3.5 介质访问控制

- 主要任务
  
    - 为使用介质的每个结点隔离来自同一信道上其他结点 所传送的信号,以协调活动结点的传输。
- 来决定广播信道中信道分配的协议属于数据链路层的 一个子层,称为介质访问控制(Medium Access Control, MAC)子层
  
    - 局域网是一种广播式的网络（广域网是一种点对点的网络），所有联网计算机都共享一个公共信道，所以，需要一种方法能有效地分配传输介质的使用权，使得两对结点之间的通信不会发生相互干扰的情况，这种功能就叫介质访问控制。
- 常见的介质访问控制方法
    - 信道划分介质访问控制
    - 随机访问介质访问控制
    - 轮询访问介质访问控制。其中前者是静态划分信道的方法,而后两者是动态分 配信道的方法。
- 3.5.1 信道划分介质访问控制
    - 将使用介质的每个设备与来自同一通信信道上的其他设备的通信隔 离开来,把时域和频域资源合理地分配给网络上的设备。
    - 多路复用技术
        - 多个信号组合在一条物理信道上进 行传输,使多个计算机或终端设备共享信道资源,提高了信道的利用率。
        - 信道划分的实质就是通过分时、分频、分码等方法把原来的一条广播信道,逻辑上分为几条 用于两个结点之间通信的互不干扰的子信道,实际上就是把广播信道转变为点对点信道。
    - 信道划分介质访问控制
        - 1. 频分多路崖用(FDM)
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FeXkH-wDHGa.png?alt=media&token=fe4c1dce-3781-4347-9930-957b45f51ba1)
            - 将多路基带信号调制到不同频率载波上,再叠加形成一个复合信号的多 路复用技术。
            - 优点
                - 分利用了传输介质的带宽,系统效率较高;
                - 技术比较成熟, 实现也较容易。
                - 缺点
                    - 为了防止子信道之间的干扰,相邻信道之间需要加入"保护频带”
        - 2. 时分多路复用(TDM)
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FUJ1Tx-obfw.png?alt=media&token=0e5dc4cb-b56f-4ade-b46e-5ec0aaadc48e)
            - 将一条物理信道按时间分成若干时间片,轮流地分配给多个信号使用。
            - 缺点
                - 由于计算机数据的突发性,一个用户对已经分配到的子 信道的利用率一般不高。
            - 优化
                - 统计时分多路复用(STDM)
                    - 是TDM的一种改进,它采用STDM帧,STDM帧并不固定分配时隙,而按需动态地分配时隙,当终端有数据要传送时,才会分配到时间片,因此可以提高线路的利用率。
        - 3. 波分多路复用(WDM) 
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F5BpPbRkC4b.png?alt=media&token=7aedbf90-e7d3-429a-b442-259337b97899)
            - 波分多路复用即光的频分多路复用,它在一根光纤中传输多种不同波长(频率)的光信号,由 于波长(频率)不同,各路光信号互不千扰,最后再用波长分解复用器将各路波长分解出来。
        - 4. 码分多路复用(CDM)
            - 码分多路复用是采用不同的编码来区分各路原始信号的一种复用方式。
            - 它既共享信道的频率,又共享时间。
            - 码分多址(Code Division Multiple Access. CDMA)
                - 每比特时间被分成农个更短的时间槽,称为码片(Chip)
                - 每个站点被指定一个唯一的和位代码或码片序列。
                - 发送1时,站点发送码片序列;发送0时,站点 发送码片序列的反码。
                - 为从信道中 分离出各路信号,要求各个站点的码片序列相互正交。
                - 例子
                    - 站点 A、B 同时发送给 C
                        - 若 A 站点的芯片序列为 (-1 -1 -1 +1 +1 -1 +1 +1)
                        - 且 B 站点的芯片序列为 (-1 -1 +1 -1 +1 +1 +1 -1)
                        - 验证正交：A ∙ B = sum(Ai * Bi) = 0
                        - 当 A 在链路中发送数据时，发送 1 (-1 -1 -1 +1 +1 -1 +1 +1) ，B 发送 0 (+1 +1 -1 +1 -1 -1 +1)；
                        - 则，在链路中的信号叠加为 (0 0 -2 2 0 -2 0 2);
                        - 当 C 收到这个叠加的序列后，想获得 A 的数据，则将收到的序列与A的序列点积，得 1。
                        - 当同理，想获得 B 的数据时，点积B的序列获得 -1 ，即0。
- 3.5.2 随机访问介质访问控制
    - 不采用集中控制方式解决发送信息的次序问题,所有用户能根据自己的 意愿随机地发送信息,占用信道全部速率。
    - 为了解决随机接入发生的碰撞,每个用户需要按照一定的规则反复地重传它的帧,直到该帧 无碰撞地通过。这些规则就是随机访问介质访问控制协议,
        - 常用的协议有ALOHA协议、CSMA 协议、CSMA/CD协议和CSMA/CA协议等,
        - 核心思想都是:胜利者通过争用获得信道, 从而获得信息的发送权。
    - 随机介质访问控制实质上是一种将广播信道转化为点到点信道的 行为
    - 1. ALOHA 协议
        - (1)纯ALOHA协议
            - 基本思想
                - 当网络中的任何一个站点需要发送数据时,可以不进行任何 检测就发送数据。如果在一段时间内未收到确认,那么该站点就认为传输过程中发生了冲突。发 送站点需要等待一段时间后再发送数据,直至发送成功。
            - 吞吐量
                - S=Ge^(-2G)
                    - 当 G =0.5 时，S_MAX = 0.184
            - 纯ALOHA网络的吞吐量很低
        - 2) 时隙ALOHA协议
            - 把所有各站在时间上同步起来,并将时间划分为一段段等长的时隙( Slot) , 规定只能在每个时隙开始时才能发送一个帧。
            - 吞吐量
                - S = Ge^(-G)
                    - 当 G=1时, S_MAX =0.368
    - 2. CSMA 协议
        - 若每个站点在发送前都先侦听一下共用信道,发现信道空闲后再发送"则就会大大降低冲突 的可能,从而提高信道的利用率
        - (1) 1-坚持 CSMA
            - 过程
                - 1. 发送前首先侦听
                - 2. 空闲则以概率1 发送，即立即发送
                - 3. 忙，则持续侦听至空闲
                - 4. 冲突，则随机等待一段时间后重发。
            - 特点
                - 传播延迟对1-坚持CSMA协议的性能影响较大。
        - (2) 非坚持CSMA
            - 过程
                - 1. 发送前侦听
                - 2. 空闲则发送
                - 3. 忙，则放弃侦听，一个随机事件后重发。
            - 特点
                - 降低了多个结点等待信道空闲后同时 发送数据导致冲突的概率,但也会增加数据在网络中的平均延迟。
                - 信道利用率的提高是以 增加数据在网络中的延迟时间为代价的。
        - (3) P-坚持CSMA
            - 过程
                - 1. 发送前侦听
                - 2. 忙则等待，并且持续侦听
                - 3. 空闲则以概率 p 发送，1-p 的概率推迟到下一个时隙。
            - 特点
                - 是非坚持CSMA协议和1-坚持CSMA协议的折中方案。
    - 3. CSMA/CD 协议
        - 适用于总线形网络或半双工网络环境。
        - 载波帧听
            - “载波帧听〃就是发送前先 侦听,即每个站在发送数据之前先要检测一下总线上是否有其他站点正在发送数据,若有则暂时不 发送数据,等待信道变为空闲时再发送。
        - 碰撞检测
            - “碰撞检测”就是边发送边侦听,即适配器边发送数据边 检测信道上信号电压的变化情况,以便判断自己在发送数据时其他站点是否也在发送数据。
        - 过程
            - 1. 侦听带信道空闲，则传输
            - 2. 忙，则等待到空闲在开始传输
            - 3. 传输过程中检测到冲突，则停止并发送 48 bit 的拥塞信号
            - 4. 由于冲突中止后，使用 截断二进制指数算法来随机等待。
            - 冲突恢复（等待）：
                - 1. 确定基本退避时间（一般是 争用期时间 2τ）
                - 2. K = min(重传次数, 10)
                - 3. 重传退避时间 = 2rτ，r 为 随机从 [0, 2^k-1] 中选取，τ 为单程传播时延
                - 4. 重传 16 次后不成功则失败
        - 最小帧长
            - 为了确保发送站在发送数据的同时能检测到可能存在的冲突,需要在发送完帧之前就能收到 自己发送出去的数据,即帧的传输时延至少要两倍于信号在总线中的传播时延
            - 最小帧长 = 总线传播时延 * 数据传输率 * 2
    - 4. CSMA/CA 协议
        - 不能简单 地搬用CSMA/CD协议,特别是碰撞检测部分。
            - 1) 接收信号的强度往往会远小于发送信号的强度,且在无线介质上信号强度的动态变化范 围很大,因此若要实现碰撞检测,则硬件上的花费就会过大。
            - 2)  在无线通信中,并非所有的站点都能够听见对方,即存在“隐蔽站”问题。
        - 实现碰撞避免的三种机制
            - 预约信道
                - 广播自己传输需要的时间长度
            - 接收方收到 数据帧或内容 需回复一个 ack 帧
            - RTS/CTS
                - 同 ACK 帧类似，用于解决“隐蔽站”问题
        - 802.11 的 MAC 子层
            - 操作模式
                - DCF: Distributed Coordination Function
                    - 使用 CSMA/CA 
                    - 提供 RTS/CTS
                        - 主机向AP提出申请预约信道
                        - 信道广播CTS，非目标主机根据RTS的信息（计算占用时间）进入NAV
                    - 利用竞争窗口的二进制指数回退机制协调多个STA对共享链路的访问，避免出现因争抢介质而无法通信的情况
                      
                        - 其核心思想是利用二进制指数回退机制减轻数据分组的碰撞以及实现发生碰撞后对分组的有限重传控制
                    - 过程：
                        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2Fbv_VLQ0xVL.png?alt=media&token=ea0bcc32-073d-485b-a597-788ecaa420bd)
                        - 1. 第一个帧时，等待分布式帧间隔（DIFS）后发送该帧
                        - 2. 之后的帧
                            - 1. 等待 DIFS 后，
                                - 若空闲，则进入随机回退
                                
                                - 若忙，则进入 Busy Medium
                            - 2. 随机回退过程中，
                                - 首先从争用窗口选取一哥随机数（802.11中默认初试竞争窗口为 31）
                                - 每经过一个slot time，监听一次信道，空闲则随机回退计数减1
                            - 3. 计数至 0 时，发送
                                - AP 收到后在 SIFS 后发送 ACK 确认帧（此时又开始间隙）
                                - 未收到确认帧，争用窗口增大
                            - 回到 1.
                    - 几种帧间隔
                        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F7c4aaSQkKH.png?alt=media&token=c88bf360-0f55-4d00-a96d-758445f7c101)
                        - SIFS：控制帧或下一个分片
                        - PIFS：PCF帧
                        - DIFS：DCF帧
                        - EIFS：怀损帧 重发等待
                    - MAC 帧格式
                        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FmZ77U5-QDt.png?alt=media&token=e67010cd-362a-48b9-8d3a-dfe74852a11d)
                        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FLRvd5a-9mH.png?alt=media&token=0b789f34-8f68-4829-b79f-ee704e527b94)
                        - Frame Control 各字段含义 2B
                            - Protocol Version:  目前为0
                            - Type:              帧类别, 有下面三种, 每个类别又有一些子类别
                            - Subtype:           帧子类别, 与Type共同来决定一个帧的类型, 详细如下表所示
                            - To DS/From DS:     指示帧目的地是否为DS(分布式系统), 可以简单地理解为是否【发往/来自】AP
                            - More fragments:    指示是否还有分片(除去最后一个分片)
                            - Retry:             指示当前帧是否为重传帧, 接收方收到后会删掉重复帧
                            - Power management:  指示STA的电源管理模式, 1表示STA在数据交换完成后进入省电模式, 对于AP恒为0
                            - More data:         指示AP为进入省电模式的STA进行帧缓存(来自DS)
                            - WEP:               指示frame body是否使用WEP加密
                            - Order:             指示将进行严格次序(StrictlyOrdered)传送
                        - 持续时间: 2B
                        - 地址1: 6B 一般链路的接收 MAC
                        - 地址2: 6B 一般链路的发送 MAC
                        - 地址3: 6B 路由器MAC
                        - 序号: 2B
                        - 地址4: 6B AP自组织模式中
                        - 信息主体: 0 - 2312B
                        - CRC: 4B
                - PCF: Point Coordination Function
                    - PCF作为DCF的补充，是一种可选的介质访问机制
                    - 提供了不必通过竞争即可使用介质的服务，为了满足实时业务需求
                    - PCF以周期的形式进行帧的传输
                        - 每个周期包括一个无竞争阶段和一个竞争阶段
                            - 无竞争阶段(CFP: Contention-Free Period) 
                            - 竞争阶段(CP: Contention Period)
- 3.5.3 轮询访问介质访问控制:令牌传递协议
    - 通过一个集中控制的监控站,以循环方式轮 询每个结点,再决定信道的分配。
    - 一个令牌在各结点间以某个固定次序交换
    - 令牌是由一组特殊的比特组 合而成的帧。
    - 当环上的一个站希望传送帧时,必须等待令牌。
    - 一旦收到令牌,站点便可启动发送 帧。帧中包括目的站的地址,以标识哪个站应接收此帧。
    - 帧在环上传送时,不管该帧是否是发给 本站点的,所有站点都进行转发,直到该帧回到它的始发站,并由该始发站撤销该帧。
    - 帧的目的 站除转发帔外,应针对该帧维持一个副本,并通过在帧的尾部设置“响应比特"来指示已收到此 副本。
    - 站点在发送完一帧后,应释放令牌,以便让其他站使用。
    - 轮询介质访问控制非常适合负载很高的广播信道。

### 3.6 局域网

- 3.6.1 局域网的基本概念和体系结构
  
    - 指在一个较小的地理范围(如一所学校)内,将各种 计算机、外部设备和数据库系统等通过双绞线、同轴电缆等连接介质互相连接起来,组成资源和 信息共享的计算机互联网络
    - 主要特点
        - 1) 为一个单位所拥有,且地理范围和站点数目均有限。
        - 2)  所有站点共享较高的总带宽(即较高的数据传输率)。
        - 3)  较低的时延和较低的误码率。
        - 4)  各站为平等关系而非主从关系。
        - 5)  能进行广播和组播。
    - 局域网的特性主要由三个要素决定
        - 拓扑结构
            - 1 星形结构;
            - 2 环形结构;
            - 3 总线形结构;
            - 4 星形和总线形结合的复合型结构
        - 传输介质
            - 双绞线
                - 双绞线为主流传输介质
            - 铜缆
            - 光纤等
        - 介质访问控制方式
            - 最重要 的是介质访问控制方式,它决定着局域网的技术特性。
                - 总线形局域网
                    - 令牌总线
                    - CSMA/CD
                - 环形局域网
                    - 令牌环
        - 三种特殊的局域网拓扑实现
            - 以太网
                - 逻辑拓扑是总线形结构,物理拓扑是星形或拓展 星形结构。
            - 令牌环
                - 逻辑拓扑是环形结构,物理拓扑是星形结构
            - FDDI
                - 逻辑拓扑是环形结构,物理拓扑是双环结构。
- 3.6.2 以太网与 IEEE 802.3
    - 描述物理层和数据链路层的MAC子层的 实现方法。
        - 是指符合DIX Ethernet V2标准的局域网,但DIX Ethernet V2标准与 IEEE 802.3标准只有很小的差别,因此通常将802.3局域网简称为以太网。
            - 数据链路层拆分为两个子层:
                - 逻辑链路控制(LLC) 
                    - 与传输 媒体无关,它向网络层提供无确认无连接、面向连接、带确认无连接、高速传送4种不同的连接 服务类型。
                - 媒体接入控制(MAC) 子层
                    - 与接入传输媒体有关的内容都放在MAC子层,它向上层屏蔽对物理层访问的各种差异,提供对物理层的 统一访问接口,主要功能包括:组帧和拆卸帧、比特传输差错检测、透明传输。
    - 以太网逻辑上采用总线形拓扑结构,以太网中的所有计算机共享同一条总线,信息以广播方 式发送。
        - 总线上使用的是广播通信
    - 简化了通信流程并使用了 CSMA/CD方式对总线进行访问控制。
    - 两项措施简化通信
        - 用无连接的工作方式;
        - 不对发送的数据帧编号,也不要求 接收方发送确认,即以太网尽最大努力交付数据,提供的是不可靠服务,对于差错的纠正则由高 层完成。
    - 1.以太网的传输介质与网卡
        - 传输介质
            - Subtopic
        - 网卡：网络接口板[又称网络适配器(Adapter) 或网络接口卡(NetworkInterface Card， NIC) ]
            - 工作在数据链路层的网路组件
                - 控制着主机对介质的访问,因此网卡也工作在物理层,因为它只关注比特,而不 关注任何地址信息和高层协议信息。
            - 是局域网中连接计算机和传输介质的接口
            - 功能
                - 现与局域网传输介质之 间的物理连接和电信号匹配
                - 涉及帧的发送与接收、帧的封装与拆封、介质访问控制、数据的编码 与解码及数据缓存功能等
            - 出厂时都有一个唯一的代码,称为介质访问控制(MAC) 地址
                - 用于控制主机在网络上的数据通信
    - 2.以太网的MAC帧
        - 每块网络适配器・ (网卡)都有一个地址,称为MAC地址,也称物理地址;
            - MAC地址长6 字节,一般用由连字符(或冒号)分隔的6个十六进制数表示,如02-60-8c-e4-b1-21高24位为 厂商代码,低24位为厂商自行分配的网卡序列号。
        - 网卡从网络上每收到一个MAC帧,首先要用硬件检查 MAC帧中的MAC地址。如果是发往本站的帧,那么就收下,否则丢弃。
        - 以太网MAC帧格式
            - 有两种标准：DIX Ethernet V2 和 IEEE 802.3
            - 由于历史原因，现有 Ethernet V2 再有 IEEE 802.3，且 前者比后者少 8 bit 长度。目前是 Ethernet V2 是主流。IEEE 802.3 的帧结构与 Ethernet V2 的不同点：
            - 802.3 一共 14 bit，6 + 6 + 2，前12 bit 与V2一样，最后 2 bit 代表 长度。
            - 且由于 802.3 是在 802.2 以上构建的，所以 802.3 的 14 bit 后还紧跟着 802.2 的 8 bit。
            - 网卡为了兼容两种协议,是这么来实现的:
            - 网卡只发送 Ethernet2格式帧,可以接收两种格式的帧,怎么分辨两种格式呢?就是判断 length/ethertype 的那 2 bit 的内容，如果大于 1500 则为 Ethernet2,否则为802.3.
                - Subtopic
                    - 前导码
                        - 前导码:使接收端与发送端时钟同步。在帧前面插入的8字节可再分为两个字段:第一个字段共7字节,是前同步码,用来快速实现MAC帧的比特同步;第二个字段是帧开始定界符,表示后面的信息就是MAC帧。
                    - 地址
                        - 地址:通常使用6字节( 48bit) 地址(MAC地址)。
                    - 类型
                        - 类型:2字节,指出数据域中携带的数据应交给哪个协议实体处理。
                    - 数据
                        - 数据:46〜1500字节,包含高层的协议消息。由于CSMA/CD算法的限制,以太网帧必须满 足最小长度要求64字节,数据较少时必须加以填充(0-46字节)。
                            - 46和1500是怎么来的?
                                - 首先,由CSMA/CD算法可知以太网帧的最短帧长为64B, 而MAC帧的首部和尾部的长度为18字节,所以数据最短为64-18 = 46字节。其次,最大的15GG 字节是规定的,没有为什么。
                    - 校验码(FCS)
                        - 校验码(FCS) : 4字节,校验范围从目的地址段到数据段的末尾,算法采用32位循环冗余 码( CRC),不但需要检验MAC帧的数据部分,还要检验目的地址、源地址和类型字段,但不校验前导码。
    - 3.高速以太网
        - (1) 100BASE-T 以太网
            - 既支持全双工方式,又支持半双工方式。
            - 全双工方式下，无冲突发生，不使用CSMA/CD协议；半双工方式下，使用 CSMA/CD
            - 使用 100BASE-T 传输介质
            - 最长电缆长度为 100m，帧间隔从 9.6 微秒 改为 0.96 微秒。
        - (2) 吉比特以太网
            - 在 1Gb/s下用全双工和半双工两种方式工作。
            - 使用 802.3 协议规定的帧格式。
            - 在半双工方式下使用CSMA/CD协议(全双工方式不需要使用CSMA/CD协 议)。
        - (3) 10吉比特以太网
            - 只使用光纤作为传输媒体。
            - 只工作在全双工方式
                - 不使用 CSMA/CD 协议
- 3.6.3 IEEE 802.11
    - IEEE 802.11是无线局域网的一系列协议标准,包括802.11a和802.11b等。它们制定了 MAC 层协议,运行在多个物理层标准上。
    - 除基本的协调访问问题外,标准还进行错误控制(以克服通 道固有的不可靠性)、适宜的寻址和关联规程(以处理站的可携带性和移动性)、互联过程(以扩 展无线站的通信范围),并且允许用户在移动的同时进行通信。
    - 802.11的MAC层采用CSMA/CA协议进行介质访问控制。
    - 1. 有固定基础设施无线局域网
        - 802.11标准规定无线局域网的最小构件是基本服务集(Basic Service Set, BSS)。
            - 一个基本服 务集包括一个基站和若干移动站。
                - 基本服务集中的基站也称接入点(Access Point, AP),其作用和 网桥相似。
            - 所有的站在本BSS内都可以直接通信,但在与本BSS外的站 通信时都要通过本BSS的基站。
            - 一个基本服务集可以是孤立的,也可通过接入点(AP)连接到一个主干分配系统(Distribution System, DS),然后再接入另一个基本服务集,构成扩展的服务集(Extended Service Set, ESS),扩展服务集(ESS)还可通过称为门桥(Portal)的设备为无线用户提供到非802.11无线局域网(如到 有线连接的因特网)的接入。门桥的作用相当于一个网桥。
    - 2.无固定基础设施无线局域网自组织网络
        - 由一些平等状态移动站相互通信组 成的临时网络。各结点之间地位平等,中间结点都为转发结点,这些结点都具有路由器功能。
        - 一些可移动设备发现在它们附近还有其他可移动设备,并 且要求和其他移动设备通信。
        - 移动自组织网络是把移动性扩展到无线领域中的自治系统,具有自己特定的路由选择协议,并且可以 不和因特网相连,
- 3.6.4 令牌环网的基本原理
    - 令牌环网的基本原理如图3.27所示。令牌环网的每一站通过电缆与环接口干线耦合器(TCU) 相连。
        - TCU的主要作用是,传递所有经过的帧,为接入站发送和接收数据提供接口。
        - TCU的状态也有两个
            - 发送状态
            - 收听状态
    - 媒体接入控制机制
        - 采用的是分布式控制模式的循环方法
        - 令牌实际上是一个特殊格式的MAC控 制帧,它本身并不包含信息,仅控制信道的使用,确保在同一时刻只有一个结点能够独占信道。
        - 站点只有取得令牌后才能发送数据帧,因此令牌环网不会发生碰撞。
        - 在物理上采用星形拓扑结构,但逻辑上仍是环形拓扑结构,
        - 传递过程
            - 1)  网络空闲时,环路中只有令牌帧在循环传递。
            - 2)  令牌传递到有数据要发送的站点处时,该站点就修改令牌中的一个标志位,并在令牌中 附加自己需要传输的数据,将令牌变成一个数据帧,然后将这个数据帧发送出去。
            - 3)  数据帧沿着环路传输,接收到的站点一边转发数据,一边查看帧的目的地址。如果目的 地址和自己的地址相同,那么接收站就复制该数据帧以便进一步处理。
            - 4)  数据帧沿着环路传输,直到到达该帧的源站点,源站点接收到自己发出去的数据帧后便 不再进行转发。同时,发送方可以通过检验返回的数据帧来查看数据传输过程中是否有 错,若有错则重传该帧。
            - 5)  源站点传送完数据后,重新产生一个令牌,并将令牌传递给下一个站点,以交出对媒体 的访问权限。

### 3.7 广城网

- 3.7.1 广域网的基本概念
  
    - 通常是覆盖范围很广的长距离网络
    - 结点交换机的链路都是高速链路, 它可以长达几千千米的光缆线路,也可以是长达几万千米的点对点卫星链路。
    - 广域网首要考虑的问题是通信容量必须足够大,以便支持日益增长的通信量。
    - 由一些结点交换机及连接这些交换机的链路组成。
    - 结点交换机的功能是将分组存储并转发。
    - 结点之间都是点 到点连接
    - 广域网和局域网的区别与联系
    - 一个重要问题是路由选择和分组转发。
        - 路由选择协议负责搜索分组从某个结点到目的结点的最佳传输路由，以便构造路由表。然后从路中表再构造中转发分组的转发表c分组是 通过转发表进行转发的。
    - PPP协议和HDLC协议是目前最常用的两种广域网数据链路层控制协议。
- 3.7.2 PPP 协议
    - 串行线路通信的面向字节的协议
        - 所有PPP帧的长度都是整数个字节
    - 三个组成部分
        - 链路控制协议(LCP)
            - 1) 链路控制协议(LCP)。 一种扩展链路控制协议,用于建立、配置、测试和管理数据链路。
        - 网络控制协议(NCP)
            - 2) 网络控制协议(NCP)。PPP协议允许同时采用多种网络层协议,每个不同的网络层协议 要用一个相应的NCP来配置,为网络层协议建立和配置逻辑连接。
        - —个将IP数据报封装到串行链路的方法
            - 3) —个将IP数据报封装到串行链路的方法。IP数据报在PPP帧中就是其信息部分,这个信 息部分的长度受最大传送单元(MTU)的限制。
    - PPP帧的格式
        - 标志字段
            - 标志字段(Flag)仍为 0x7E (01111110)
        - 地址字段
            - 地址字段(Address)占1字节,规定为 OxFF,固定不变的
        - 控制字段
            - 控制字段(Control)占1字节,规定为 0x03固定不变的
        - 协议段
            - 协议段,占2字节说明信息段中运载的是什么 种类的分组。
                - 以比特0开始的是诸如IP、IPX和AppleTalk这样的网络层协议;以比特1开始的 被用来协商其他协议,包括LCP及每个支持的网络层协议的一个不同的NCPo
        - 信息段
            - 信息段。长度是可变的,大于等于0且小于等于1500B
            - 为了实现透明传输,当信息 段中出现和标志字段一样的比特组合时,必须采用一些措施来改进。
            - 因为PPP是点对点的,并不是总线形,所以无须采用CSMA/CD协议,自然就没有最 短帧,所以信息段占0〜1500字节,而不是46〜1500字节。
            - 帧检验序列(FCS),占2字节,即循环冗余码检验中的冗余码。
            - 检验区包括地址字段、控制字段、协议字段、信息字段。
    - 状态图
        - Subtopic
    - 特点
        - 1)  PPP提供差错检测但不提供纠错功能,只保证无差错接收(通过硬件进行CRC校验)。 
            - 它是不可靠的传输协议,因此也不使用序号和确认机制。
        - 2)  它仅支持点对点的链路通信,不支持多点线路。
        - 3) PPP只支持全双工链路。
        - 4) PPP的两端可以运行不同的网络层协议,但仍然可使用同一个PPP进行通信。
        - 5) PPP是面向字节的,当信息字段出现和标志字段一致的比特组合时,PPP有两种不同的处理方法:若PPP用在异步线路(默认),则采用字节填充法;若PPP用在SONET/SDH 等同步线路,则协议规定采用硬件来完成比特填充(和HDLC的做法一样)。
- 3.7.3 HDLC 协议
    - 面向比特的数据链路层协议。
        - 协议不依赖于任何一种字符编码集;
        - 数据报文可透明传输,用于实现透明传输的“0比特插入法”易于硬件实现;
    - 特点
        - 全双工通信,有较高的数据 链路传输效率;
        - 所有帧采用CRC检验,对信息帧进行顺序编号,可防止漏收或重发,传输可靠 性高;
        - 传输控制功能与处理功能分离,具有较大的灵活性。
    - 基本配置
        - 非平衡配置
            - 1) 非平衡配置的特点是由一个主站控制整个链路的工作。
        - 平衡配置
            - 2)  平衡配置的特点是链路两端的两个站都是复合站,每个复合站都可以平等地发起数据传 输,而不需要得到对方复合站的允许。
    - 1. 站
        - 主站
            - 主站负责控制链路的操作,主站发出的帧 称为命令帧。
        - 从站
            - 从站受控于主站,按主站的命令进行操作;发出的帧称为响应帧。
        - 复合站
            - 既具有主站的功能,又具有从站的功能,所以这类站称为复合站"它可以发出命令帧和响 应帧。
    - 2. 数据操作方式
        - 1)  正常响应方式。这是一种非平衡结构操作方式,即主站向从站传输数据,从站响应传输, 但从站只有在收到主站的许可后,才可进行响应。
        - 2)  异步平衡方式。这是一种平衡结构操作方式。在这种方式中,每个复合站都可以进行对 另一站的数据传输。
        - 3)  异步响应方式。这是一种非平衡结构操作方式。在这种方式中,从站即使未受到主站的 允许,也可进行传输。
    - 3. HDLC 帧
        - 标志字段 F,为01111110。
            - 在接收端只要找到标志字段就可确定一个帧的位置。
            - HDLC协议 采用比特填充的首尾标志法实现透明传输。
            - 在发送端,当一串比特流数据中有5个连续的1时, 就立即在其后填入一个0。
            - 接收帧时,先找到F字段以确定帧的边界,接着对比特流进行扫描。每当发现5个连续的1时,就将其后的一个0删除,以还原成原来的比特流。
        - 地址字段 A, 共8位,
            - 在使用非平衡方式传送数据时,站地址字段总是写入从站的地址;在 使用平衡方式传送数据时,站地址字段填入的是应答站的地址。
        - 控制字段 c，共8位
            - 信息帧
                - 1)  信息帧(I),第1位为0,用来传输数据信息,或使用捎带技术对数据进行确认。
            - 监督帧
                - 2)  监督帧(S),第1、2位分别为1、0,用于流量控制和差错控制,执行对信息帧的确认、 请求重发和请求暂停发送等功能;
            - 无编号帧
                - 3)  无编号帧(U),第1、2位均为L用于提供对链路的建立、拆除等多种控制功能。

### 3.8 数据链路层设备

- 3.8.1 网桥的概念及其基本原理
  
    - 两个或多个以太网通过网桥连接后,就成为一个覆盖范围更大的以太网,而原来的每个以太 网就称为一个网段
    - 网桥工作在链路层的MAC子层,可以使以太网各网段成为隔离开的碰撞域
    - 网桥必须具有路径选择的功能,接收到帧后,要决定正确的路径,将该帧转送到相应的目的 局域网站点。
    - 网桥的基本特点:
        - 1网桥必须具备寻址和路径选择能力,以确定帧的传输方向;
        - 2从源网络 接收帧,以目的网络的介质访问控制协议向目的网络转发该帧;
        - 3网桥在不同或相同类型的LAN 之间存储并转发帧,必要时还进行链路层上的协议转换。
            - 注意,一般情况下,存储转发类设备都 能进行协议转换,即连接的两个网段可以使用不同的协议;
        - 4网桥对接收到的帧不做任何修改, 或只对帧的封装格式做很少的修改;
        - 5网桥可以通过执行帧翻译互联不同类型的局域网,即把原 协议的信息段的内容作为另一种协议的信息部分封装在帧中;
        - 6网桥应有足够大的缓冲空间,因 为在短时间内帧的到达速率可能高于转发速率。
    - 网桥的优点:
        - 1能过滤通信量;
        - 2扩大了物理范围;
        - 3可使用不同的物理层;
        - 4可互联不同 类型的局域网;
        - 5提高了可靠性;
        - 6性能得到改善。
    - 网桥的缺点
        - 1. 增大了时时延
        - 2. MAC 子层没有流量控制功能
            - 控制需要用到编号机制，编号机制的实现在 LLC 子层
        - 3不同MAC子层的网段桥接在一起时,需要进行帧格式的转换;
        - 4网桥只适合于用户数不多和通信量不大的局域网,否则有时还会因传播过多的广播信息而产生 网络拥塞,这就是所谓的广播风暴。
    - 网桥类别（路由算法不同）
        - 1. 透明网桥(选择的不是最佳路由)
            - 以混杂方式工作
            - 到达帧的路由选择 过程取决于源LAN和目的LAN:
                - 1如果源LAN和目的LAN相同,那么丢弃该帧;
                - 2如果源LAN 和目的LAN不同,那么转发该帧;
                - 3如果目的LAN未知,那么扩散该帧。
            - 转发表
                - 基本思想
                    - 若从站A发出的帧从某端口进入网桥,那么从这个端口出发沿相反方向一定可把一 个帧传送到站A。
                - 过程
                    - 接收
                        - 每收到一个帧,就记下其源地址和进入网桥的端口,作为转发表中的 一个项目(源地址、进入的接口和时间)。
                        - 在建立转发表时,把帧首部中的源地址写在“地址” 一栏的下面。
                    - 发送
                        - 在转发帧时,则根据收到的帧首部中的目的地址来转发。
                        - 时就把在“地址〃栏下 面已经记下的源地址当作目的地址,而把记下的进入端口当作转发端口。
            - 避免转发的帧在网络中不断地“兜圈子七
                - 使用了一种生成树算法(无环),以 确保每个源到每个目的地只有唯一的路径。
                    - 使得整个扩展局域网在逻辑上形成树形结构, 所以工作时逻辑上没有环路,但生成树一般不是最佳路由。
        - 2. 源路由网桥(选择的是最佳路由)
            - 作用
                - 路由选择由发送数据帧的源站负责
                - 网桥只根据数据真正的路由信息对帧进行接收和转发。
            - 特点
                - 源路由网桥对主机是不透明的,主机必须知道网桥的标识及连接到哪个网段上。
            - 路由选择
                - 由发送帧的源站负责
                - 过程
                    - 在未知路径前,源站要先发送一个发现帧;
                        - 帮助源站确定整个网络可以通过的帧的最大长度
                    - 途中的每个网桥都转发此帧,最终该发现帧可能从多个途径到达目的站;
                    - 目的站也将一一发送应答帧;
                    - 每个应答帧将通过原路径返回,途经的网桥把自己的标志记录在应答帧中;
                    - 源站选择出一个最佳路由。
                    - 以后,凡从这个源站向该目的站发送的帧 的首部,都必须携带这一路由信息。
        - 比较
            - 若在两个以太网之间使用并联的源路由网桥,则还可使 通信量较平均地分配给每个网桥。
            - 采用透明网桥时,只能使用生成树,而使用生成树一般并不能保证所用的路由是最佳的,也不能在不同的链路中进行负载均衡。
            - 帧爆炸问题
                - 透明网桥：数量为线性函数
                - 源路由网桥：数量为指数型增加
- 3.8.2 局域网交换机及其工作原理
    - 1. 局域网交换机
        - 从本质上说,以太网交换机是一个多端口的网桥,它工作在数据链路层
        - 交换机能经济地将网络分成小的冲突域,为每个工作站提供更高的带宽
        - 利用以太网交换机还可以方便地实现虚拟局域网(VirtualLAN, VLAN) , VLAN不 仅可以隔离冲突域,而且可以隔离广播域。
    - 2、 原理
        - 检测从以太端口来的数据帧的源和目的地的MAC (介质访问层) 地址,
        - 然后与系统内部的动态查找表进行比较,若数据帧的MAC地址不在查找表中,则将该地 址加入查找表,并将数据帧发送给相应的目的端口。
    - 3. 特点
        - 1)  以太网交换机的每个端口都直接与单台主机相连(普通网桥的端口往往连接到以太网的 一个网段),并且一般都工作在全双工方式。
        - 2)  以太网交换机能同时连通许多对端口,使每对相互通信的主机都能像独占通信媒体那样, 无碰撞地传输数据。
        - 3)  以太网交换机也是一种即插即用设备(和透明网桥一样),其内部的帧的转发表也是通过 自学习算法自动地逐渐建立起来的。
        - 4)  以太网交换机由于使用了专用的交换结构芯片,因此交换速率较高。
        - 5)  以太网交换机独占传输媒体的带宽。
    - 4。 两种交换模式
        - 1)  直通式交换机
            - 只检杳帧的目的地址
                - 帧在接收后几乎能马上被传出去
            - 速度快,但缺乏智能性和安全性,也无法支持具有不同速率的端口的交换。
        - 2)  存储转发式交换机
            - 先将接收到的帧缓存到高速缓存器中,并检查数据是否正确,确认无 误后通过查找表转换成输出端口将该帧发送出去。
            - 如果发现帧有错,那么就将其丢弃。
            - 存储转发式的优点是可靠性高,并能支持不同速率端口间的转换,缺点是延迟较大。

<div style="page-break-after:always;"></div>

## 第四章 网络层

### 4.1 网络层的功能

- 4.1.1异构网络互联
    - 网络层所要完成的任务之一就是使这些异构的网络实现互联。
        - 不同的寻址方案、不同的网络接入机制、不同的差错处理方法、不 同的路由选择机制等。
        - 网络互联
            - 指将两个以上的计算机网络,通过一定的方法,用一种或多种通信处理设 备(即中间设备)相互连接起来,以构成更大的网络系统。
    - 中继系统
        - 1) 物理层中继系统:中继器,集线器(Hub) 
        - 2)  数据链路层中继系统:网桥或交换机。
        - 3)  网络层中继系统:路由器。
        - 4)  网络层以上的中继系统:网关。
    - 虚拟互联网络也就是逻辑互联网络,即互联起来的各种物理网络的异构性本来是客观存在 的,但是通过使用IP就可以使这些性能各异的网络在网络层上看起来好像是一个统一的网络。
        - 好处是:当互联网上的主机进行通信时,就好像在一个网络上通信一样, 而看不见互联的具体的网络异构细节
- 4.1.2路由与转发
    - 两个功能
        - 一是路由选择(确定哪一条路径)
            - 据特定的路由选择协议构造出路由表,同时经常或定期地和相 邻路由器交换路由信息而不断地更新和维护路由表。
            - 指按照复杂的分布式算法,根据从各相邻路由器所得到的关于整个网络拓扑 的变化情况,动态地改变所选择的路由。
        - 二是分组转发(当一个分组 到达时所采取的动作)
            - 处理通过路由器的数据流,关键操作是 转发表查询、转发及相关的队列管理和任务调度等。
            - 指路由器根据转发表将用户的IP数据报从合适的端口转发出去。
    - 路由表与转发表
        - 讨论路由选择的原理时,往往不去 区分转发表和路由表,而是笼统地使用路由表一词。
            - 路由表
                - 根据路由选择算法得出
                - 转发表的结构应当使查找 过程最优化
            - 转发表
                - 从路由表得出的
                - 需要对网络拓扑变化的计算最优化
- 4.1.3 拥塞控制
    - 因出现过量的分组而引起网络性能下降的现象称为拥塞
    - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FBEotw61SCb.png?alt=media&token=c7a8019f-0fe4-4ccb-84f0-1565967d8b4b)
    - 判断网络是否进入拥塞状态的方法是
        - 观察网络的吞吐量与网络负载的关系
            - 如果随着网络负载的增加,网络的吞吐量明显小于正常的吞吐量,那么网络就可能已进入“轻度拥塞”状态;
            - 如果网络的吞吐量随着网络负载的增大而下降,那么网络就可能已进入拥塞状态;
            - 如果网络的负载继续增大,而网络的吞吐量下降到零,那么网络就可能已进入死锁状态
    - 拥塞控制
        - 解决的问题
            - 解决的问题是如何获取同络中发生拥塞的信息,从而利用这些信息进行控制,以避免由于拥塞而出现分组的丢失,以及严重拥塞而产生网络死锁的现象。
        - 作用
            - 作用是确保子网能够承载所达到的流量
                - 这是一个全局性的过程,涉及各方面的行为:主机、路由器及路由器内部的转发处理过程等。单一地增加资源并不能解决拥塞。
    - 流量控制和拥塞控制的区别:
        - 流量控制往往是指在发送端和接收端之间的点对点通信量的控制。流量控制所要做的是抑制发送端发送数据的速率,以便使接收端来得及接收。
        - 拥塞控制必须确保通信子网能够传送特传送的数据,是一个全局性的问题,涉及网络中所有的主机、路由器及导致网络传输能力下降的所有因素。
    - 方法
        - 1)开环控制
            - 在设计网络时事先将有关发生拥塞的因素考虑周到,力求网络在工作时不产生拥塞。
            - 一种静态的预防方法
            - 一旦整个系统启动并运行,中途就不再需要修改。
            - 手段
                - 确定何时可接收新流量、何时可丢弃分组及丢弃哪些分组,确定何种调度决策等。
                - 在做决定时不考虑当前网络的状态。
        - 2)闭环控制
            - 事先不考虑有关发生拥塞的各种因素,采用监测网络系统去监视,及时检测哪里发生了拥塞,然后将拥塞信息传到合适的地方,以便调整网络系统的运行,并解决出现的I巧题。
            - 闭环控制是基于反馈环路的概念,是一种动态的方法。

### 4.2路由算法

- 4.2.1 静态路由与动态路由
    - 静态路由算法(又称非自适应路由算法)
        - 概念
            - 由网络管理员手工配置的路由信息。
            - 当网络的 拓扑结构或链路的状态发生变化时,网络管理员需要手工去修改路由表中相关的静态路由信息。 
        - 适用范围
            - 广泛用于高度安全的军事系统和较小的商业网络
            - 大型和复杂的网络环境通常不宜采用静态路由。
        - 优点
            - 简便、可靠,在负荷稳定、拓扑变化不大的网络中运行效果很好
        - 缺陷
            - 一方面,网络管理员难以全面了解整个网络的拓扑结构;
            - 另一方面,当网络的拓扑结构和链路状态发生变化时,路由器中的静态路由信息需要大 范围地调整,这一工作的难度和复杂程度非常高。
    - 动态路由算法(又称自适应路由算法)
        - 概念
            - 路由器上的路由表项是通过相互连接的路由器之 间彼此交换信息,然后按照一定的算法优化出来的,而这些路由信息会在一定时间间隙里不断更 新,以适应不断变化的网络,随时获得最优的寻路效果。
        - 优点
            - 能改善网络的性能并有助于 流量控制;
        - 缺点
            - 算法复杂,会增加网络的负担,有时因对动态变化的反应太快而引起振荡,或反应 太慢而影响网络路由的一致性,
        - 常用的算法
            - 距离-向量路由算法和链路状态路由算法。
- 动态路由算法
    - 4.2.2 距离-向量路由算法
        - 原理
            - 所有结点都定期地将它们的整个路由选择表传送给所有与之直接相 邻的结点。
                - 路由选择表包含
                    - •每条路径的目的地(另一结点)。
                    - •路径的代价(也称距离)。
                        - 距离是一个抽象的概念
            - 实质
                - 迭代计算一条路由中的站段数或延迟时间,从而得到到达一个目标的最短(最小代价)通路。
                - Bellman-Ford或者Ford-Fulkerson算法
        - 更新路由选择表的条件
            - 1)  被通告一条新的路由,该路由在本结点的路由表中不存在,此时本地系统加入这条新的 路由。
            - 2)  发来的路由信息中有一条到达某个目的地的路由,该路由与当前使用的路由相比,有较短的距离(较小的代价)。
                - 此种情况下,就用经过发送路由信息的结点的新路由替换路由表中到达那个目的地的现有路由。
        - 缺点
            - 容易出现路由环路的情况
            - 更新报文的大小与通信子网的结点个数成正比,大的通信子网将导致很大的更新报文。由于更新报文发给直接邻接的结点,所以所有结点都将参加路由选择信息交换。基于
            - 这些原因,在通信子网上传送的路由选择信息的数量很容易变得非常大。
        - 最常见的距离-向量路由算法
            - RIP算法
    - 4.2.3 链路状态路由算法
        - 原理
            - 每个参与该算法的结点都具有完全的网络拓扑信息
            - 执行两项任务。
                - 主动测试所有邻接结点的状态。
                    - 两个共享一条链接的结点是相邻结点,它们连接到同一条链路,或者连接到同一广播型物理网络。
                - 定期地将链路状态传播给所有其他结点 (或称路由结点)
            - 报文处理
                - 每当链路状态报文到达时,路由结点便使用这些状态信息去更新自己的网络拓扑和状态“视 野图〃,一旦链路状态发生变化,结点就对更新的网络图利用Dijsktra最短路径算法重新计算路由, 从单一的源出发计算到达所有目的结点的最短路径。
        - 典型的链路状态算法
            - OSPF算法
        - 链路状态路由算法主要有三个特征:
            - 1)  向本自治系统(见424节)中所有路由器发送信息,这里使用的方法是泛洪法,即路由 器通过所有端口向所有相邻的路由器发送信息。
            - 2)  发送的信息是与路由器相邻的所有路由器的链路状态
                - 只是路由器所知道的部分信 息。
                - 所谓“链路状态",是指说明本路由器与哪些路由器相邻及该链路的“度量〃。
            - 3)  只有当链路状态发生变化时,路由器才向所有路由器发送此消息。
        - 使用范围
            - 可以用于大型的或路由信息变化聚敛的互联网环境。
        - 优点
            - 每个路由结点都使用同样的原始状态数据独立地计算路 径,而不依赖中间结点的计算;
            - 链路状态报文不加改变地传播,因此采用该算法易于查找故障。
            - 当一个结点从所有其他结点接收到报文时,它可以在本地立即计算正确的通路,保证一步汇聚。
            - 由于链路状态报文仅运载来自单个结点关于直接链路的信息,其大小与网络中的路由结点 数目无关,因此链路状态算法比距离-向量算法有更好的规模可伸展性。
- 距离-向量路由算法与链路状态路由算法的比较:
    - 距离-向量路由算法
        - 每个结点仅与它的直接邻居交谈
        - 它为它的邻居提供从自己到网络中所有其他结点的最低费用估计。
    - 链路状态路由算法
        - 每个结点通过广播的方式与所有其他结点交谈,但它仅告诉它们与它直接相连的链路的费用。
            - 创建拓扑图
                - 链路状态路由协议会创建拓扑图，即SPF树，而距离矢量路由协议没有网络的拓扑图，仅有一个网络列表，其中列出了通往各个网络的开销（距离）和下一跳路由器（方向）。
                - 因为链路状态路由协议会交换链路状态信息，所以SPF算法可以构建网络的SPF树，有了SPF树，路由器可独立确定通向每个网络的最短路径。
            - 快速收敛
                - 收到一个链路状态数据包（LSP）后链路状态路由协议便立即将该LSP从除接收该LSP的接口以外的所有接口泛洪出去。
                - 使用距离矢量路由协议的路由器需要处理每个路由更新，并且在更新完路由表后才能将更新从路由器接口泛洪出去，即使对触发更新也是如此。
            - 事件驱动更新
                - 在初始LSP泛洪之后，链路状态路由协议仅在拓扑发生改变时才发出LSP。
                - 与某些距离矢量路由协议不同的是，链路状态路由协议不会定期发送更新。
            - 层次式设计
                - 链路状态路由协议，如OSPF和IS-IS使用了区域的概念。多个区域形成了层次化的网络结构，这有利于路由聚合（汇总），还便于将路由问题隔离在一个区域内。
- 4.2.4 层次路由
    - 背景
        - 当网络规模扩大时,路由器的路由表成比例地增大。这不仅会消耗越来越多的路由器缓冲区 空间,而且需要用更多CPU时间来扫描路由表,用更多的带宽来交换路由状态信息。
    - 两大类协议
        - 每个自治系统有权自主地决定本系统内应采用何种路由选择协议。如果两个自治系统需要通信, 那么就需要一种在两个自治系统之间的协议来屏蔽这些差异。
        - 1)  一个自治系统内部所使用的路由选择协议称为内部网关协议(IGP),也称域内路由选择, 具体的协议有RIP和OSPF等
            - OSPF将一个自治系统再划分为若干区域(Area),每个路由器都知道在本 区域内如何把分组路由到目的地的细节,但不用知道其他区域的内部结构。
            - 采用分层次划分区域的方法虽然会使交换信息的种类增多,但也会使OSPF协议更加复杂。 
                - 但这样做却能使每个区域内部交换路由信息的通信量大大减小,因而使OSPF协议能够用于规模很大的自治系统中。
        - 2)  自治系统之间所使用的路由选择协议称为外部网关协议(EGP),也称域间路由选择,用 在不同自治系统的路由器之间交换路由信息,并负责为分组在不同自治系统之间选择最 优的路径。具体的协议有BGP

### 4.3 IPv4

- 4.3.1 IPv4 分组
  
    - 内容
        - IP定义数据传送的基本单元— —IP分组及其确切的数 据格式。
        - IP也包括一套规则,指明分组如何处理、错误怎样控制。
        - 特别是IP还包含非可靠投递 的思想,以及与此关联的分组路由选择的思想。
    - 1. IPv4分组的格式
        - 由首部和数据两部分组成。
        - 首部
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FBVrin40Z7D.png?alt=media&token=6285049b-04d4-4b57-99c8-d59385e52df7)
            - 前一部分的长度固定,共20B,是所有IP分组 必须具有的。
            - 后面是一些可选字段,其长度可变,用来提供错误检测及安全等 机制。
            - 重要字段含义
                - 1)  版本
                    - 指IP的版本,目前广泛使用的版本号为4。
                - 2)  首部长度
                    - 占4位。
                    - 以32位（8B）为单位
                    - 最大值为60B ( 15x4B) 。最常用的首部长度是20B
                - 3)  总长度
                    - 占16位。
                    - 指首部和数据之和的长度,单位为字节,因此数据报的最大长度为2况-1 = 65535B。
                    - 以太网帧的最大传送单元(MTU) 为1500B,因此当一个IP数据报封装成帧时, 数据报的总长度(首部加数据)一定不能超过下面数据链路层的MTU值。
                - 4)  标识
                    - 占16位。
                    - 它是一个计数器,每产生一个数据报就加1,并赋值给标识字段。
                    - 当一个数据报的长度超过网络的MTU时,必须分片,此时每个数据报片都复制一次标识号,以便能正确重装成原来的数据报。
                - 5)  标志
                    - 占3位。
                    - 标志字段的最低位为MF(More Fragmaent), MF = 1表示后面还有分片,MF = 0表示最后 一个分片。
                    - 标志字段中间的一位是DF,只有当DF = 0时才允许分片。
                - 6)  片偏移
                    - 占13位。
                    - 以 8B 为偏移单位,
                    - 它指出较长的分组在分片后,某片在原分组中的相对位置。
                - 7)  首部校验和
                    - 占16位。
                    - IP数据报的首部校验和只校验分组的首部,而不校验数据部分。
                - 8)  生存时间 ( TTL) 
                    - 占8位。
                    - 数据报在网络中可通过的路由器数的最大值,标识分组在两 络中的寿命,以确保分组不会永远在网络中循环。
                    - 路由器在转发分组前,先把TTL减1。 
                        - 若TTL被减为0,则该分组必须丢弃。
                - 9)  协议
                    - 占8位。
                    - 指出此分组携带的数据使用何种协议,即分组的数据部分应交给哪个传 输层协议,如TCP、UDP等。其中值为6表示TCP,值为17表示UDP。
                - 10)  源地址字段
                    - 占4B,
                    - 标识发送方的IP地址。
                - 11)  目的地址字段
                    - 占4B
                    - 标识接收方的IP地址。
    - 2. IP数据报分片
        - 最大传送单元(MTU)
            - 一个链路层数据报能承载的最大数据量
        - 分片
            - 当IP数据报的总长度大于链路MTU时,就需要将 IP数据报中的数据分装在两个或多个较小的IP数据报中,这些较小的数据报称为片。
                - 片在目的地的网络层被重新组装。
                    - 目的主机使用IP首部中的标识、标志和片偏移字段来完 成对片的重组。
        - IP分片涉及的计算
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FGRv_nTTI2g.png?alt=media&token=bcef4809-e36a-48ef-95c3-06ea8dbec6bc)
    - 3. 网络层转发分组的流程
        - 分组转发算法
            - 1)  从数据报的首部提取目的主机的IP地址D，得出目的网络地址N。
            - 2)  若网络N与此路由器直接相连,则把数据报直接交付给目的主机D,这称为路由器的直 接交付;否则是间接交付,执行步骤3) 。
            - 3)  若路由表中有目的地址为D的特定主机路由,则把数据报传送给路由表中所指明的下一跳路由器;否则;执行步骤4) 。
            - 4)  若路由表中有到达网络N的路由,则把数据报传送给路由表指明的下一跳路由器;否则, 执行步骤5) 。
            - 5)  若路由表中有一个默认路由,则把数据报传送给路由表中所指明的默认路由器;否则, 执行步骤6) 。
            - 6)  报告转发分组出错。
        - 注意
            - 得到下一跳路由器的IP地址后并不是直接将该地址填入待发送的数据报,而是将该 IP地址转换成MAC地址,将其放到MAC帧首部中,然后才艮据这个 MAC地址找到下一跳路由器。
- 4.3.2 IPv4 地址与 NAT
    - 1. IPv4地址
        - 32比特的全球唯一标识符
        - 组成
            - IP地址`::`={<网络号>,<主机号>}
        - IP划分
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FJRZA_wMA-z.png?alt=media&token=1a871200-1c27-45d2-beb6-da2d84edbf2f)
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FMCBStOk66l.png?alt=media&token=0e27480f-73e6-432c-9662-d991c635aa0b)
            - 特殊地址
                - 主机号全为0表示本网络本身
                - 主机号全为1表示本网络的广播地址，又称直接广播地址
                - 127.0.0.0保留为环路自检( LoopbackTest) 地址,此地址表示任意主机本身,目的地址为 环回地址的IP数据报永远不会出现在任何网络上。
                - 32位全为0,即0.0Q0表示本网络上的本主机。
                - 32位全为1,即255.255.255.255表示整个TCP/IP网络的广播地址,又称受限广播地址。
                    - 实际使用时,由于路由器对广播域的隔离,255.255.255.255等效为本网络的广播地址。
        - 特点
            - 1)  每个IP地址都由网络号和主机号两部分组成,因此IP地址是一种分等级的地址结构。
                - 1. IP地址管理机构在分配IP地址时只分配网络号(第一级),而主机号 (第二级)则由得到该网络的单位自行分配,方便了 IP地址的管理;
                - 2. 路由器仅根据目的主机所连接的网络号来转发分组(而不考虑目标主机号),从而减小了路由表所占的存储空间。
            - 2)  IP地址是标志一台主机(或路由器)和一条链路的接口。
                - 当一台主机同时连接到两个网 络时,该主机就必须同时具有两个相应的IP地址,每个IP地址的网络号必须与所在网络 的网络号相同,且这两个IP地址的网络号是不同的。
                - IP网络上的一个路由器必然至 少应具有两个IP地址(路由器每个端口必须至少分配一个IP地址)。
            - 3) 用转发器或桥接器(网桥等)连接的若干LAN仍然是同一个网络(同一个广播域),因 此该LAN中所有主机的IP地址的网络号必须相同,但主机号必须不同。
            - 4)  在IP地址中,所有分配到网络号的网络(无论是LAN还是WAN) 都是平等的。
            - 5)  在同一个局域网上的主机或路由器的IP地址中的网络号必须是一样的。
                - 路由器总是具有两个或两个以上的IP地址,路由器的每个端口都有一个不同网络号的IP地址。
    - 2。网络地址转换(NAT)
        - 指通过将专用网络地址(如Intranet)转换为公用地址(如Internet), 从而对外隐藏内部管理的IP地址。
        - 作用
            - 使得整个专用网只需要一个全球IP地址就可以与因特网连 通,由于专用网本地IP地址是可重用的,所以NAT大大节省了 IP地址的消耗。
            - 它隐藏了 内部网络结构,从而降低了内部网络受到攻击的风险。
        - 私有IP地址
            - 只用于LAN,不用 于WAN连接
            - 因此私有IP地址不能直接用于Internet,必须通过网关利用NAT把私有IP地址转 换为Internet中合法的全球IP地址后才能用于Internet
            - A 类:1 个 A 类网段,即 10.0.0.0〜10.255.255.255
            - B 类:16 个 B 类网段,艮P 172.16.0.0—172.31.255.255
            - C 类:256 个 C 类网段,即 192.160.0—192.168.255.255
        - 要求
            - 需要在专用网连接到因特网的路由器上安装NAT软件,NAT路由器至少有一个 有效的外部全球地址。
        - NAT转换表
            - 可让多个私有IP地址映射到同一个全球IP地址。
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FMLjvGAPhGd.png?alt=media&token=df8a9526-cd53-49b9-b05f-5f028c25ea65)
        - 注意
            - 普通路由器在转发IP数据报时,不改变其源IP地址和目的IP地址。而NAT路由器 在转发IP数据报时,一定要更换其IP地址(转换源IP地址或目的IP地址)。
            - 普通路由器仅工作在网络层,而NAT路由器转发数据报时需要查看和转换传输层的端口号。
- 4.3.3 子网划分与子网掩码、CIDR
    - 1. 子网划分
        - 两级IP地址的缺点
            - IP地址空间的利用率有时很低;
            - 每个物理网络分配一个网络号会使 路由表变得太大而使网络性能变坏;
            - 两级的IP地址不够灵活。
        - 基本思路
            - 子网划分纯属一个单位内部的事情。单位对外仍然表现为没有划分子网的网络。
            - 从主机号借用若干比特作为子网号,当然主机号也就相应减少了相同的比特。
                - 三级IP地 址的结构如下:IP地址={〈网络号〉,〈子网号〉,〈主机号>}。
            - 凡是从其他网络发送给本单位某台主机的IP数据报,仍然是根据IP数据报的目的网络号, 先找到连接到本单位网络上的路由器。然后该路由器在收到IP数据报后,按目的网络号 和子网号找到目的子网。最后把IP数据报直接交付给目的主机。
        - 注意点
            - 划分子网只是把 IP 地址的主机号这部分进行再划分,而不改变IP地址原来的网络号。
                - 因此,从一个IP地址本身或IP数据报的首部,无法判断源主机或目的主机所连接的网络是否进行了子网划分。
            - 对分类的IPv4地址进行于网划分时,子网号不能为全1或全0。
                - 但随着 CIDR的广泛使用,现在全1和全0的子网号也可使用,但一定要谨慎使用,要弄清你的 路由器所用的路由选择软件是否支持全0或全1的子网号。
            - 不论是分类的IPv4地址还是CIDR,其子网中的主机号为全0或全1的地址都不能被指 派。
    - 2.子网掩码
        - 为了告诉主机或路由器对一个A类、B类、C类网络进行了子网划分,使用子网掩码来表达对原网络中主机号的借位。
        - 是一个与IP地址相对应的、长32bit的二进制串,它由一串1和跟随的一串0组成。 
            - 其中,1对应于IP地址中的网络号及子网号,而0对应于主机号。
            - 计算机只需将IP地址和其对 应的子网掩码逐位“与”(逻辑AND运算),就可得出相应子网的网络地址。
        - 默认子网掩码
            - A、B、C类地址的默认子网掩码分别为255.0.0.0、255.255.0.0、255.255.255.0。 
        - 路由器在相互之间交换路由信息时, 必须把自己所在网络(或子网)的子网掩码告诉对方。路由表中的每个条目,除要给出目的网络 地址和下一跳地址外,还要同时给出该目的网络的子网掩码。
        - 使用子网掩码的情况
            - 1)  一台主机在设置IP地址信息的同时,必须设置子网掩码。
            - 2)  同属于一个子网的所有主机及路由器的相应端口,必须设置相同的子网掩码。
            - 3)  路由器的路由表中,所包含信息的主要内容必须有目的网络地址、子网掩码、下一跳地址。
        - 使用子网掩码时路由器的分组转发算法
            - 1)  从收到的分组的首部提取目的IP地址,记为D。
            - 2)  先判断是否为直接交付。
            - 对路由器直接相连的网络逐个进行检查:用各网络的子网掩码和D逐位相“与",看结果是否和相应的网络地址匹配。若匹配,则将分组直接交付,否 则间接交付,执行步骤3) 。
            - 3)  若路由表中有目的地址为D的特定主机路由,则将分组传送给路由表中所指明的下一跳 路由器;否则,执行4) 。
            - 4)  对路由表中的每一行(目的网络地址、子网掩码、下一跳地址)中的子网掩码和D逐位相“与，其结果为N。若N与该行的目的网络地址匹配,则将分组传送给该行指明的下 一跳路由器;否则,执行步骤5) 。
            - 5)  若路由表中有一个默认路由,则将分组传送给路由表中所指明的默认路由器;否则,执 行步骤6) 
            - 6)  报告转发分组出错
    - 3. 无分类域间路由选择(CIDR)
        - 是在变长子网掩码的基础上提出的一种消除传统A、B、C类网络划分, 并且可以在软件的支持下实现超网构造的一种IP地址的划分方法。
        - 主要特点
            - 1) 消除了传统A、B、C类地址及划分子网的概念,因而可以更有效地分配IPv4的地址空 间。CIDR使用“网络前缀〃的概念代替子网络的概念。
                - 因此,IP地址的无分类两级编址 为：IP`::`={< 网络前缀〉,<主机号>}。
                - CIDR还使用“斜线记法〃(或称CIDR记法),即IP地址/网络前缀所占比特数。
                    - 例如,对 于128.14.32.5/20这个地址,它的掩码是20个连续的1和后续12个连续的0,通过逐位 相“与“的方法可以得到该地址的网络前缀
                    - Subtopic
            - 2) 将网络前缀都相同的连续IP地址组成“CIDR地址块七
                - 一个CIDR地址块可以表示很多 地址,这种地址的聚合称为路由聚合,或称构成超网。路由聚合使得路由表中的一个项 目可以表示多个原来传统分类地址的路由,有利于减少路由器之间的路由选择信息的交 换,从而提高网络性能。
            - CIDR地址块中的地址数一定是2的整数次慕,实际可指派的地址数通常为2^n-2, N表示主机号的位数,主机号全0代表网络号,主机号全1为广播地址。
                - 网络前缀越短,其地址块所包含 的地址数就越多。而在三级结构的IP地址中,划分子网是使网络前缀变长。
        - 最长前缀匹配(最佳匹配)
            - 使用CIDR时,路由表中的每个项目由“网络前缀”和“下一 跳地址”组成。在查找路由表时可能会得到不止一个匹配结果。此时,应当从匹配结果中选择具 有最长网络前缀的路由,因为网络前缀越长,其地址块就越小,因而路由就越具体。
        - CIDR查找路由表的方法
            - 为了更加有效地查找最长前缀匹配,通常将无分类编址的路由表 存放在一种层次的数据结构中,然后自上而下地按层次进行查找。这里最常用的数据结构就是二 叉线索C
- 4.3.4 ARP、DHCP ICMP
    - 1. IP地址与硬件地址
        - IP地址是网络层使用的地址,它是分层次等级的。
        - 硬件地址是数据链路层使用的地址(如 MAC地址),它是平面式的。
        - 田于路由器的隔商,IP网络中无法通过厂播方式依靠MAC地址来完成跨网络的寻址,因此在IP网络的网络层只使用IP地址来完成寻址。
            - 寻址时,每个路由器依据其路由表选择到目标网络需要转发到的下一跳,而IP分组通过多次路由转发到达目标网络后,改为在目标LAN中通过数据链路层的MAC地址以广播方式寻址。这样可以提高路由选择的效率。
    - 2.地址解析协议(ARP)
        - 无论网络层使用什么协议,在实际网络的链路上传送数据帧时,最终必须使用硬件地址。所 以需要一种方法来完成IP地址到MAC地址的映射,这就是地址解析协议(Addiess Resolution ProtocoL ARP)。
        - 从IP地址到硬件地址的解析是自动进行的,主机的用户并不知道这种地址解析过程。
        - ARP表
            - ARP高速缓存
            - 存放本局域网上各主机和路由器的IP 地址到MAC地址的映射表
            - 使用ARP来动态维护
        - 工作原理
            - 先在其ARP高速缓存中查看有无主机B的IP地址。
            - 如有,就可查出其对应的硬件地址,再 将此硬件地址写入MAC帧,然后通过局域网将该MAC帧发往此硬件地址。
            - 如果没有,那么就通过使用目的MAC地址为FF-FF-FF-FF-FF-FF的帧来封装并广播ARP请求分组,使同一个局域网里的所有主机收到ARP请求。
            - 主机B收到该ARP请求后,向主机A发出响应ARP分组,分 组中包含主机B的]IP与MAC地址的映射关系,主机A在收到后将此映射写入ARP缓存,然后 按查询到的硬件地址发送MAC帧。
        - 4种典型情况总结
            - 1)  发送方是主机时,要把IP数据报发送到本网络上的另一台主机。这时用ARP找到目的主 机的硬件地址。
            - 2)  发送方是主机时,要把IP数据报发送到另一个网络上的一台主机。这时用ARP找到本网 络上的一个路由器的硬件地址,剩下的工作由这个路由器来完成。
            - 3)  发送方是路由器时,要把IP数据报转发到本网络上的一台主机。这时用ARP找到目的主 机的硬件地址。
            - 4)发送方是路由器时,要把IP数据报转发到另一个网络上的一台主机。这时用ARP找到木 网络上的一个路由器的硬件地址,剩下的工作由找到的这个路由器完成。
    - 3.动态主机配置协议(DHCP)
        - 常用于给主机动态地分配 IP地址,它提供了即插即用联网的机制
        - 允许一台计算机加入新的网络和获取IP地址 而不用手工参与。DHCP 是应用层协议,它是基于UDP 的。
        - 工作原理
            - 使用客户/服务器方式。
            - 需要IP地址的主机在启动时就向DHCP服 务器广播发送发现报文,这时该主机就成为DHCP客户。
            - 本地网络上所有主机都能收到此广播报文,但只有DHCP服务器才回答此广播报文。
            - DHCP服务器先在其数据库中查找该计算机的配置信息。若找到,则返回找到的信息。若找不到,则从服务器的IP地址池中取一个地址分配给该计算机。
            - DHCP服务器的回答报文称为提供报文
        - 聚合DHCP客户端的交换过程
            - 1) DHCP客户机广播“DHCP发现〃消息,试图找到网络中的DHCP服务器,以便从DHCP 服务器获得一个IP地址。
            - 2) DHCP服务器收到“DHCP发现”消息后,向网络中广播“DHCP提供"消息,其中包括 提供DHCP客户机的IP地址和相关配置信息。
            - 3) DHCP客户机收到“DHCP提供〃消息,如果接收DHCP服务器所提供的相关参数,那 么通过广播“DHCP请求乃消息向DHCP服务器请求提供IP地址。
            - 4) DHCP服务器广播“DHCP确认〃消息,将IP地址分配给DHCP客户机。
        - 当DHCP客户机发出DHCP请求时,有可能收 到多个应答消息。这时,DHCP客户机只会挑选其中的一个,通常挑选最先到达的。
        - DHCP服务器分配给DHCP客户的IP地址是临时的,因此DHCP客户只能在一段有限的时 间内使用这个分配到的IP地址。DHCP称这段时间为租用期。租用期的数值应由DHCP服务器 自己决定,DHCP客户也可在自己发送的报文中提出对租用期的要求。
    - 4. 网际控制报文协议(ICMP)
        - 为了提高IP数据报交付成功的机会,在网络层使用了网际控制报文协议(mternet Control Message ProtocoL ICMP)来让主机或路由器报告差错和异常情况。
        - ICMP是IP层协议
        - 种类
            - ICMP差错报告报文
                - 用于目标主机或到目标主机路径上的路由器向源主机报告差错和异常情况
                - 1)  终点不可达。当路由器或主机不能交付数据报时,就向源点发送终点不可达报文。
                - 2)  源点抑制。当路由器或主机由于拥塞而丢弃数据报时,就向源点发送源点抑制报文,使源点知道应当把数据报的发送速率放慢。
                - 3)  时间超过。当路由器收到生存时间( TTL) 为零的数据报时,除丢弃该数据报外,还要向 源点发送时间超过报文。当终点在预先规定的时间内不能收到一个数据报的全部数据报 片时,就把已收到的数据报片都丢弃,并向源点发送时间超过报文。
                - 4)  参数问题。当路由器或目的主机收到的数据报的首部中有的字段的值不正确时,就丢弃 该数据报,并向源点发送参数问题报文。
                - 5)  改变路由(重定向)。路由器把改变路由报文发送给主机,让主机知道下次应将数据报发 送给另外的路由器(可通过更好的路由)。
                - 不应发送ICMP差错报告报文的几种情况
                    - 1)  对ICMP差错报告报文不再发送ICMP差错报告报文。
                    - 2)  对第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报告报文。
                    - 3)  对具有组播地址的数据报都不发送ICMP差错报告报文。
                    - 4)  对具有特殊地址(如127.0.0.0或0.0.0.0) 的数据报不发送ICMP差错报告报文。
            - ICMP询问报文
                - 回送请求和回答报文
                - 时间戳请求和回答报文
                - 掩码地址请求和回答报文
                - 路由器询问和通告报文
        - 常见应用
            - 分组网间探测PING
                - PING使用了 ICMP回送请求和回答报文
                - PING工作在应用层,它直接使用网络层的ICMP,而未使用传输层的TCP或UDPO 
            - Traceroute
                - 使用了 ICMP时间超过报文
                - Traceroute/Tracert 工作在网络层

### 4.4 IPv6

- 4.4.1 IPv6的主要特点
    - 解决IP地址耗尽问题的措施
        - 采用无类别编址CIDR
        - 采用网络地址转换(NAT) 方法以节省全球IP地址;
        - 采用具有更大地址空间的新版本 的IPv6。
    - 主要特点
        - 1)  更大的地址空间。IPv6将地址从IPv4的32位增大到了 128位。IPv6的字节数( 16B) 是 IPv4字节数( 4B) 的平方。
        - 2)  扩展的地址层次结构。
        - 3)  灵活的首部格式。
        - 4)  改进的选项。
        - 5)  允许协议继续扩充。
        - 6)  支持即插即用(即自动配置)。
        - 7)  支持资源的预分配。
        - 8)  IPv6只有在包的源结点才能分片,是端到端的,传输路径中的路由器不能分片,所以从 一般意义上说,IPv6不允许分片(不允许类似IPv4在路由分片)。
        - 9)  IPv6首部长度必须是8B的整数倍,而IPv4首部是4B的整数倍。
        - 10)  增大了安全性。身份验证和保密功能是IPv6的关键特征。
- 4.4.2 IPv6 地址
    - IPv6数据报的目的地址可以是以下三种基本类型地址之一:
        - 1) 单播。单播就是传统的点对点通信。
        - 1) 单播。单播就是传统的点对点通信。
        - 2)  多播。多播是一点对多点的通信,分组被交付到一组计算机的每台计算机。
        - 3)  任播。这是IPv6增加的一种类型。任播的目的站是一组计算机,但数据报在交付时只交 付其中的一台计算机,通常是距离最近的一台计算机。
    - 表示法
        - 每4位用一个十六进制数 表示,并用冒号分隔每 16 位,如 4BF5:AA12:0216:FEBC:BA5F:039A:BE9A:2170。
        - 缩写成更紧凑的形式
            - 当16位域的开头有一些0时,可以采用一种缩写表 示法,但在域中必须至少有一个数字。例如,可以把地址4BF5:0000:0000:0000:BA5F:039A:000A:2176 缩写为 4BF5:0:0:0:BA5F:39A:A:2176。
            - 当有相继的0值域时,还可以进一步缩写。这些域可以用双冒号缩写(`::`) 4BF5::BA5F:39A:A:2176。
    - 扩展了 IPv4地址的分级概念
        - 为了使路由器能够更快地查找路由。
            - 第一级(顶级)指明全球都知道 的公共拓扑;
            - 第二级(场点级)指明单个场点;
            - 第三级指明单个网络接口。
    - IPv4向IPv6过渡
        - 采用逐步演进的办法,同时还必须使新安装的IPv6系统能够向后兼容。 
        - IPv6系统必须能够接收和转发IPv4分组,并且能够为IPv4分组选择路由。
        - 两种策略:
            - 双协议栈技术
                - 双协议栈技术是指在一台设备上 同时装有IPv4和IPv6协议栈,那么这台设备既能和IPv4网络通信,又能和IPv6网络通信。
            - 隧道技术
                - 隧道技术是将整个IPv6数据报封装到 IPv4数据报的数据部分,使得IPv6数据报可以在IPv4网络的隧道中传输。

### 4.5 路由协议

- 4.5.1 自治系统
  
    - 单一技术管理下的一组路由器,这些路由器使用一种 AS内部的路由选择协议和共同的度量来确定分组在该AS内的路由,同时还使用一种AS之间的 路由选择协议来确定分组在AS之间的路由。
    - 一个自治系统内的所有网络都由一个行政单位(如一家公司、一所大学、一个政府部门等) 管辖,一个自治系统的所有路由器在本自治系统内都必须是连通的。
- 4.5.2 域内路由与域间路由
    - 自治系统内部的路由选择称为域内路由选择,自治系统之间的路由选择称为域间路由选择。
    - 两大类路由选择协议
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FSPEpDXcnrQ.png?alt=media&token=b01c8a5e-3ce6-4e08-86b3-83eb9b3bf34e)
        - 1. 内部网关协议内 ( Interior Gateway Protocol， IGP)
            - 在一个自治系统内部使用的路由选择协议,它与互联网中其他自治系统选用 什么路由选择协议无关。
            - 使用得最多
                - RIP和OSPF
        - 2. 外部网关协议( External Gateway Protocol, EGP)
            - 若源站和目的站处在不同的自治系统中,当数据报传到一个自治系统的边界时(两个自治系 统可能使用不同的IGP),就需要使用一种协议将路由选择信息传递到另一个自治系统中。
            - 使用最多
                - BGP-4
- 4.5.3 路由信息协议(RIP)
    - 内部网关协议( IGP) 中最先得到广泛 应用的协议。RIP是一种分布式的基于距离向量的路由选择协议,其最大优点就是简单。
    - 1. RIP规定
        - 1)  网络中的每个路由器都要维护从它自身到其他每个目的网络的距离记录(因此这是一组 距离,称为距离向量)。
        - 2)  距离也称跳数( Hop Count),规定从一个路由器到直接连接网络的距离(跳数)为1。而 每经过一个路由器,距离(跳数)加1。
        - 3)  RIP认为好的路由就是它通过的路由器的数目少,即优先选择跳数少的路径。
        - 4)  RIP允许一条路径最多只能包含15个路由器(即最多允许15跳)。因此距离等于16时, 它表示网络不可达。
        - 5)  RIP默认在任意两个使用RIP的路由器之间每30秒广播一次RIP路由更新信息,以便自 动建立并维护路由表(动态维护)。
        - 6)  在RIP中不支持子网掩码的RIP广播,所以RIP中每个网络的子网掩码必须相同。但在 新的RIP2中,支持变长子网掩码和CIDRO
    - 2. RIP的特点
        - 1)  仅和相邻路由器交换信息。
        - 2)  路由器交换的信息是当前路由器所知道的全部信息,即自己的路由表。
        - 3)  按固定的时间间隔交换路由信息,如每隔30秒。
    - 3. 距离向量算法
        - 每个路由表项目都有三个关键数据:<目的网络N, 距离d, 下一跳路由器X〉。
        - 步骤
            - 1)  对地址为X的相邻路由器发来的RIP报文,先修改此报文中的所有项目:把“下一跳” 字段中的地址都改为X,并把所有“距离,'字段的值加lo
            - 2)  对修改后的RIP报文中的每个项目,执行如下步骤:
                - 1 当原来的路由表中没有目的网络N时,把该项目添加到路由表中。
                - 2 当原来的路由表中有目的网络N，且下一跳路由器的地址是X时,用收到的项目替换原路由表中的项目。
                - 3 当原来的路由表中有目的网络N, 且下一跳路由器的地址不是X时,如果收到的项目中的距离d小于路中表中的距离,那么就用收到的项目替换原路由表中的项目;否则什么也不做。
            - 3)  如果180秒(RIP默认超时时间为180秒)还没有收到相邻路由器的更新路由表,那么把 此相邻路由器记为不可达路由器,即把距离设置为16( 距离为16表示不可达)。
            - 4)  返回。
        - 缺点
            - 1)RIP限制了网络的规模,它能使用的最大距离为15 ( 16表示不可达)。
            - 2)  路由器之间交换的是路由器中的完整路由表,因此网络规模越大,开销也越大。
            - 3)  网络出现故障时,会出现慢收敛现象(即需要较长时间才能将此信息传送到所有路由器), 俗称“坏消息传得慢与使更新过程的收敛时间长。
        - 特点
            - RIP是应用层协议,它使用UDP传送数据(端口 520) 0
            - RIP选择的路径不一定是时间最短 的,但一定是具有最少路由器的路径。因为它是根据最少的跳数进行路径选择的。
- 4.5.4 开放最短路径优先(OSPF)协议
    - 1。 OSPF 协议的基本特点
        - 使用分布式链路状态路由算法的典型代表,也是内部网 关协议( IGP) 的一种。
        - 与RIP相比有以下4点主要区别:
            - 1) OSPF向本自治系统中的所有路由器发送信息,这里使用的方法是洪泛法。而RIP仅向自己相邻的几个路由器发送信息。 
            - 2)  发送的信息是与本路由器相邻的所有路由器的链路状态,但这只是路由器所知道的部分 信息。“链路状态”说明本路由器和哪些路由器相邻及该链路的“度量”(或代价)。而在 RIP中,发送的信息是本路由器所知道的全部信息,即整个路由表。
            - 3)  只有当链路状态发生变化时,路由器才用洪泛法向所有路由器发送此信息,并且更新过 程收敛得快,不会出现RIP “坏消息传得慢〃的问题。而在RIP中,不管网络拓扑是否 发生变化,路由器之间都会定期交换路由表的信息。
            - 4)  OSPF是网络层协议,它不使用UDP或TCP,而直接用IP数据报传送(其IP数据报首 部的协议字段为89) 。而RIP是应用层协议,它在传输层使用UDP。
        - OSPF还有以下特点
            - 1)  OSPF对不同的链路可根据IP分组的不同服务类型( TOS) 而设置成不同的代价。因此, OSPF对于不同类型的业务可计算出不同的路由,十分灵活。
            - 2)  如果到同一个目的网络有多条相同代价的路径,那么可以将通信量分配给这几条路径。 
                - 这称为多路径间的负载平衡。
            - 3)  所有在OSPF路由器之间交换的分组都具有鉴别功能,因而保证了仅在可信赖的路由器 之间交换链路状态信息。
            - 4)  支持可变长度的子网划分和无分类编址CIDRO
            - 5)  每个链路状态都带上一个32位的序号,序号越大,状态就越新。
    - 2。 OSPF的基本工作原理
        - 由于各路由器之间频繁地交换链路状态信息,因此所有路由器最终都能建立一个链路状态数 据库。
        - 这个数据库实际上就是全网的拓扑结构图,它在全网范围内是一致的(称为链路状态数据 库的同步)
        - 每个路由器根据这个全网拓扑结构图,使用Dijkstra最短路径算法计算从自己 到各目的网络的最优路径,以此构造自己的路由表。
            - 晏然使用Dijkstra 算法能计算出完整的最优路径;但路由表中不会存储完整路径,而 只存储“下一跳”(只有到了下一跳路由器,才能知道再下一跳应当怎样走)。
        - 当链路状态发生变化时,每个路由器 重新计算到各目的网络的最优路径,构造新的路由表。
    - 3。OSPF的五种分组类型
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FEGTt9_sSLL.png?alt=media&token=536915d0-1de9-4d77-ba12-0d95e8aa9065)
        - 1)  问候分组,用来发现和维持邻站的可达性。
            - 通常每隔10秒,每两个相邻路由器要交换一次问候分组,以便知道哪些站可达。
        - 2)  数据库描述分组,向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息。
        - 3)  链路状态请求分组,向对方请求发送某些链路状态项目的详细信息。
        - 4)  链路状态更新分组,用洪泛法对全网更新链路状态。
        - 5)  链路状态确认分组,对链路更新分组的确认。
    - 区域
        - 为使OSPF能够用于规模很大的网络,OSPF将一个自治系统再划分为若干更小的范围
        - 划分区域的好处是,将利用洪泛法交换链路状态信息的范围局限于每个区域而非整个自 治系统,减少了整个网络上的通信量。
        - 在一个区域内部的路由器只知道本区域的完整网络拓扑, 而不知道其他区域的网络拓扑情况。
        - 这些区域也有层次之分。处在上层的域称为主干区域歹负责 正通其他下层的区域,并且还连接其他自治域。
- 4.5.5 边界网关协议(BGP)
    - 是不同自治系统的路由器之间交换路由信息 的协议,是一种外部网关协议。
    - 常用于互联网的网关之间。
    - 路由表包含已知路由器 的列表、路由器能够达到的地址及到达每个路由器的路径的跳数。
    - BGP 的使用环境
        - 1)  因特网的规模太大,使得自治系统之间路由选择非常困难。
        - 2)  对于自治系统之间的路由选择,要寻找最佳路由是很不现实的。
        - 3)  自治系统之间的路由选择必须考虑有关策略。
    - 只能力求寻找一条能够到达目的网络且比较好的路由(不能兜圈子), 而并非寻找一条最佳路由。
    - 采用的是路径向量路由选择协议
    - BGP是应用层协议,它是基于TCP的
    - 工作原理
        - 每个自治系统的管理员要选择至少一个路由器(可以有多个)作为该 自治系统的“BGP发言人”。
            - 每个BGP发言人除必须运行BGP外,还必须运行该AS所用的内部网关协议,如OSPF或 RIPo
        - 一个BGP发言人与其他自治系统中的BGP发言人要交换路由信息, 就要先建立TCP连接
        - 然后在此连接上交换BGP报文以建立BGP会话,再利用BGP会话交换路由信息。
        - 所有BGP发言人都相互交换网络可达性的信息后,各BGP发言人就可找出到达各个自治系统的 较好路由。
        - 一个BGP发言人交换路径向量的例子
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FowXwORL-iX.png?alt=media&token=8c78de29-26a8-4ca9-9b67-58baeb7ee300)
    - 特点
        - 1)  BGP交换路由信息的结点数量级是自治系统的数量级,要比这些自治系统中的网络数少 很多。
        - 2)  每个自治系统中BGP发言人(或边界路由器)的数目是很少的。这样就使得自治系统之 间的路由选择不致过分复杂。
        - 3)  BGP支持CIDR,因此BGP的路由表也就应当包括目的网络前缀、下一跳路由器,以及 到达该目的网络所要经过的各个自治系统序列。
        - 4)  在RGP刚运行时,BGP的邻站交换整个BGP路由表,但以后只需在发生变化时更新有 变化的部分。
    - BGP-4 共使用4种报文
        - 1) 打开(Open) 报文。用来与相邻的另一个BGP发言人建立关系。
        - 2)  更新( Update) 报文。用来发送某一路由的信息,以及列出要撤销的多条路由。
        - 3)  保活(Keepalive) 报文。用来确认打开报文并周期性地证实邻站关系。
        - 4)  通知(Notification) 报文。用来发送检测到的差错。

### 4.6 IP组播

- 4.6.1 组播的概念
    - 让源计算机一次发送的单个分组可以抵达用一个组地址标识 的若干目标主机,并被它们正确接收。
    - 组播一定仅应用于UDP,它对将报文同时送往多个接收者的应用来说非常重要。
    - 缘由
        - 有的应用程序要把一个分组发送给多个目的地主机
        - 不是让源主机给每 个目的地主机都发送一个单独的分组,而是让源主机把单个分组发送给一个组播地址,该组播地 址标识一组地址。
    - IP组播也使用组播组的概念,每个组都有一个特别分配的地址,要给该组发送 的计算机将使用这个地址作为分组的目标地址。在IPv4中,这些地址在D类地址空间中分配, 而IPv6也有一部分地址空间保留给组播组。
    - 主机使用一个称为IGMP (因特网组管理协议)的协议加入组播组。
        - 使用该协议通知本 地网络上的路由器关于要接收发送给某个组播组的分组的愿望。
        - 通过扩展路由器的路由选择和转 发功能,可以在许多路由器互联的支持硬件组播的网络上面实现因特网组播。
    - 组播需要路由器的支持才能实现,能够运行组播协议的路由器称为组播 路由器。
- 4.6.2 IP组播地址
    - IP组播使用D类地址格式。
        - D类地址的前四位是1110,因此D类地址范围是224.000〜 239.255255.255 o每个D类IP地址标志一个组播组。
    - 组播数据报和一般的IP数据报的区别是,前者使用D类IP地址作为目的地址,并且首部中 的协议字段值是2,表明使用IGMP。
    - 注意
        - 1) 组播数据报也是“尽最大努力交付",不提供可靠交付。
        - 2) 组播地址只能用于目的地址,而不能用于源地址。
        - 3) 对组播数据报不产生ICMP差错报文。因此,若在PING命令后面键入组播地址,将永远 不会收到响应。
        - 4)  并非所有的D类地址都可作为组播地址。
    - IP组播可以分为两种:
        - 一种只在本局域网上进行硬件组播;
        - 另一种则在因特网的范围内进行 组播。
            - 在因特网上进行组播的最后阶段,还是要把组播数据报在局域网上用硬件组播交付给组播 组的所有成员
    - 硬件组播
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F-xrKN3DbYu.png?alt=media&token=2c80a3f2-c1e3-47fa-af69-8ddb7bb511ea)
        - 硬件地址的映射关系不是唯一的,因此收到组播数据报的主机,还要在IP层利用软件进行过滤, 把不是本主机要接收的数据报丢弃。
        - 在每个地址中,只有23位可用作组播。这只能和D类IP地址中的23位有— —对应关系。D类 IP地址可供分配的有28位,可见在这28位中,前5位不能用来构成以太网的硬件地址,
        - IANA拥有的以太网组播地址的范围是从01-00-5E-00-00-00到01-00-5E-7F-FF-FF。
- 4.6.3 IGMP与组播路由算法
    - 要使路由器知道组播组成员的信息,需要利用因特网组管理协议(Internet Group Management ProtocoL IGMP) 。
    - 连接到局域网上的组播路由器还必须和因特网上的其他组播路由器协同工作, 以便把组播数据报用最小代价传送给所有组成员,这就需要使用组播路由选择协议。
    - IGMP并不是在因特网范围内对所有组播组成员进行管理的协议。
    - IGMP不知道IP组播组包 含的成员数,也不知道这些成员分布在哪些网络上。
    - IGMP让连接到本地局域网上的组播路由器 知道本局域网上是否有主机参加或退出了某个组播组。
    - IGMP应视为TCP/IP的一部分,其工作可分为两个阶段。
        - 第一阶段:当某台主机加入新的组播组时,该主机应向组播组的组播地址发送一个IGMP报 文,声明自己要成为该组的成员。本地的组播路由器收到IGMP报文后,将组成员关系转发给因 特网上的其他组播路由器。
        - 第二阶段:因为组成员关系是动态的,本地组播路由器要周期性地探询本地局域网上的主机, 以便知道这些主机是否仍继续是组的成员。只要对某个组有一台主机响应,那么组播路由器就认 为这个组是活跃的。但一个组在经过几次的探询后仍然没有一台主机响应时,则不再将该组的成 员关系转发给其他的组播路由器。
    - 组播路由选择实际上就是要找出以源主机为根结点的组播转发树,其中每个分组在每条链路 上只传送一次
        - 不同的多播组对应于 不同的多播转发树;同一个多播组,对不同的源点也会有不同的多播转发树。
    - 三种路由算 法
        - 第一种是基于链路状态的路由选择;
        - 第二种是基于距离-向量的路由选择;
        - 三种可以建立在 任何路由器协议之上,因此称为协议无关的组播( PIM) 

### 4.7 移动IP

- 4.7.1移动IP的概念
    - 是指移动结点以固定的 网络IP地址实现跨越不同网段的漫游功能,并保证基于网络IP的网络权限在漫游过程中不发生 任何改变。
    - 目标是把分组自动地投递给移动结点。
    - 使用移动IP, 一个移动结点可以在不改变其IP地址 的情况下改变其驻留位置。
    - 三种功能实体
        - 1)  移动结点。具有永久IP地址的移动结点。
        - 2)  本地代理。在一个网络环境中,一个移动结点的永久“居所”被称为归属网络,在归属 网络中代表移动结点执行移动管理功能的实体称为归属代理(本地代理),它根据移动用 户的转交地址,采用隧道技术转交移动结点的数据包。
        - 3)外部代理。在外部网络中帮助移动结点完成移动管理功能的实体称为外部代理。
    - 移动IP技术使漫游的主机可以用多种方式连接到因特网, 移动IP的核心网络功能仍然是基于固定互联网中一直使用的各种路由选择协议,
- 4.7.2 移动IP通信过程
    - 过程
        - 1)  移动结点在本地网时,按传统的TCP/IP方式进行通信(在本地网中有固有的地址)。
        - 2)  移动结点漫游到一个外地网络时,仍然使用固定的IP地址进行通信。
            - 为了能够收到通信 对端发给它的IP分组,移动结点需要向本地代理注册当前的位置地址,这个位置地址就 是转交地址
        - 3)  本地代理接收来自转交地址的注册后,会构建一条通向转交地址的隧道,将截获的发给 移动结点的IP分组通过隧道送到转交地址处。
        - 4)  在转交地址处解除隧道封装,恢复原始的IP分组,最后送到移动结点,这样移动结点在 外网就能够收到这些发送给它的IP分组。
        - 5)  移动结点在外网通过外网的路由器或外部代理向通信对端发送IP数据包。
        - 6)  移动结点来到另一个外网时,只需向本地代理更新注册的转交地址,就可继续通信。
        - 7)  移动结点回到本地网时,移动结点向本地代理注销转交地址,这时移动结点又将使用传 统的TCP/IP方式进行通信。
    - 特点
        - 移动IP为移动主机设置了两个IP地址,即主地址和辅地址(转交地址)。移动主机在本地网 时,使用的是主地址。当移动到另一个网络时,需要获得一个临时的辅地址,但此时主地址仍然 不变。从外网移回本地网时,辅地址改变或撤销,而主地址仍然保持不变。

### 4.8 网络层设备

- 4.8.1路由器的组成和功能
    - 任务：是连接不同的网络(连接异构网 络)并完成路由转发。
    - 功能：隔离广播域；互联广播域
    - 工作过程
        - 如果源主机和目标主机在同一个网络上,那么直接交付而无须通过路由器。
        - 如果源主机和 目标主机不在同一个网络上,那么路由器按照转发表(路由表)指出的路由将数据报转发给下一 个路由器,这称为间接交付。
            - 网络通信 必须通过路由器进行转发。
    - 结构
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FHde8FN7Iug.png?alt=media&token=9a097242-bb7c-4e81-845b-4191210ae87a)
        - 控制部分
            - 核心构件是路由选择处理机
            - 任务是根据 所选定的路由选择协议构造出路由表,同时经常或定期地和其他相邻路由器交换路由信息而不断 更新和维护路由表。
        - 分组转发
            - 输入端口在从物理 层接收到的比特流中提取出链路层帧,进而从帧中提取出网络层数据报,输出端口则执行恰好相 反的操作。
            - 交换结构是路由器的关键部件,它根据转发表对分组进行处理,将某个输入端口进入 的分组从一个合适的输出端口转发出去。
            - 三种常用的交换方法
                - 通过存储器进行交换
                - 通过总 线进行交换
                - 通过互联网络进行交换
            - 一个存储转发设备实现了某个层次的功能
                - 可以互联两个在该层次上使 用不同协议的网段(网络)
                - 网桥实现了物理层和数据链路层,那么网桥可以互联两个物理 层和数据链路层不同的网段;
                - 中继器实现了物理层后,却不能互联两个物理层不同的网段,这 是因为中继器不是存储转发设备,它属于直通式设备。
    - 两个功能
        - 分组转发
            - 处理通过路由器的数据流，关键操作是转发表杳询、转发及相关的队列管理和任务调度等:
        - 路由计算
            - 通过和其他路由器进行基于 路由协议的交互,完成路由表的计算。
    - 路由器和网桥的重要区别是:
        - 网桥与高层协议无关,而路由器是面向协议的,它依据网络地 址进行操作,并进行路径选择、分段、帧格式转换、对数据报的生存时间和流量进行控制等。
- 4.8.2 路由表与路由转发
    - 路由表
        - 路由表是根据路由选择算法得出的,主要用途是路由选择。
        - 标准 的路由表有4个项目
            - 目的网络IP地址、子网掩码、下一跳IP地址、接口。
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FtIAgfZQg71.png?alt=media&token=d4e5dfff-138f-4a8a-9dc5-38644ea51e4b)
    - 转发表
        - 转发表是从路由表得出的,其表项和路由表项有直接的对应关系。
        - 结构应使查找过程最优化(而路由表则需对网络拓扑变化的计算最优化)
        - 含有一个分组将要发往的目的地址,以及分组的下一跳(即下一步接收者的目的地址,实际 为MAC地址)。
        - 可以使用一个默认路由代替所有具有相同“下一跳“ 的项目,并将默认路由设置得比其他项目的优先级低,
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FLE1_30bcnZ.png?alt=media&token=25c4b43e-7763-4c40-832e-6be7de828c36)
    - 转发和路由选择的区别
        - “转发〃是路由器根据转发表把收到的IP数据报从合适的端口 转发出去,它仅涉及一个路由器。
        - 而“路由选择"则涉及很多路由器,路由表是许多路由器协同 工作的结果。

<div style="page-break-after:always;"></div>

## 第五章 传输层

### 5.1 传输层提供的服务

- 5.1.1 传输层的功能
  
    - 概述
        - 从通信和信息处理的角度看,传输层向它上面的应用层提供通信服务,它属于面向通信部分 的最高层,同时也是用户功能中的最低层。
        - 为运行在不同主机上的进程之间提供了逻辑通信,而网络层提供 主机之间的逻辑通信。
        - 显然,即使网络层协议不可靠(网络层协议使分组丢失、混乱或重复), 传输层同样能为应用程序提供可靠的服务。
        - 网络的边缘部分的两台主机使用网络核心部分的功能进行端到端的通信 时,只有主机的协议栈才有传输层和应用层,而路由器在转发分组时都只用到下三层的功能(即 在通信子网中没有传输层,传输层只存在于通信子网以外的主机中)。
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F5zFmLg7v93.png?alt=media&token=b0a154ed-0a7d-4ef5-9c90-f2ddfad2270a)
        - 向高层用户屏蔽了低层网络核心的细节(如网络拓扑、路由协议等),它使应用进程 看见的是好像在两个传输层实体之间有一条端到端的逻辑通信信道,这条逻辑通信信道对上层的 表现却因传输层协议不同而有很大的差别。
        - 当传输层采用面向连接的TCP时,尽管下面的网络是 不可靠的,但这种逻辑通信信道就相当于一条全双工的可靠信道。但当传输层采用无连接的UDP 时,这种逻辑通信信道仍然是一条不可靠信道。
    - 功能
        - 1) 传输层提供应用进程之间的逻辑通信(即端到端的通信)。
            - 与网络层的区别是,网络层提 供的是主机之间的逻辑通信。
            - 从网络层来说,通信的双方是两台主机,IP数据报的首部给出了这两台主机的IP地址。
                - 但“两台主机之间的通信”实际上是两台主机中的应用进程之间的通信,应用进程之间 的通信又称端到端的逻辑通信。
        - 2)  复用和分用。
            - 复用是指发送方不同的应用进程都可使用同一个传输层协议传送数据;
            - 分用是指接收方的传输层在剥去报文的首部后能够把这些数据正确交付到目的应用进程。
        - 3) 传输层还要对收到的报文进行差错检测(首部和数据部分)。
            - 而网络层只检查IP数据报 的首部,不检验数据部分是否出错。
        - 4) 提供两种不同的传输协议,即面向连接的TCP和无连接的UDP。
            - 网络层无法同时实现 两种协议(即在网络层要么只提供面向连接的服务,如虚电路;要么只提供无连接服务, 如数据报,而不可能在网络层同时存在这两种方式)。
- 5.1.2 传输层的寻址与端口
    - l. 端口的作用
        - 标识主机中的应用进程
        - 端口能够让应用层的各种应用进程将其数据通过端口向下交付给传输层,以及让传输层知道 应当将其报文段中的数据向上通过端口交付给应用层相应的进程。
        - 传输层服务访问点 (TSAP),它在传输层的作用类似于IP地址在网络层的作用或MAC地址在数据链路层的作用, 只不过IP地址和MAC地址标识的是主机,而端口标识的是主机中的应用进程。
            - 数据链路层的SAP是MAC地址,网络层的SAP是IP地址,传输层的SAP是端口。
        - 在协议栈层间的抽象的协议端口是软件端口,它与路由器或交换机上的硬件端口是完全不同 的概念。
            - 硬件端口是不同硬件设备进行交互的接口,而软件端日是应用层的各种协议进程与传输 实体进行层间交互的一种地址。传输层使用的是软件端口。
    - 2. 端口号
        - 长度为16bit,能够表示65536(2^16)个不同的端口号
        - 只具有本地意义,即端口号只标识本计算机应用层中的各进程
        - 两类
            - 1)服务端使用的端口号。
                - 熟知端口号
                    - 数值为0〜1023
                    - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FJFM1_NrB5o.png?alt=media&token=c5a34d73-5bad-4c33-bf6a-2a4323e4c46b)
                - 登记端口号
                    - 数值为1024〜49151
                    - 供没有熟知端 口号的应用程序使用的,使用这类端口号必须在IANA登记,以防止重复。
            - 2) 客户端使用的端口号,
                - 数值为49152〜65535
                - 这类端口号仅在客户进程运行时才动 态地选择,因此又称短暂端口号(也称临时端口)。
                - 通信结束后,刚用过的客户端口号就 不复存在,从而这个端口号就可供其他客户进程使用。
    - 3.套接字
        - 网络中采用发送方和接收方的套接字( Socket) 组合来识别端点。
        - 所谓套接字, 实际上是一个通信端点;它唯一地标识网络中的一台主机和其上的一个应用(进程)。
            - 套接字=(主机IP地址,端口号)
- 5.1.3 无连接服务与面向连接服务
    - 面向连接服务
        - 就是在通信双方进行通信之前,必须先建立连接,在通信过程中,整个连接的 情况一直被实时地监控和管理。通信结束后,应该释放这个连接。
    - 无连接服务
        - 指两个实体之间的通信不需要先建立好连接,需要通信时,直接将信息发送到 “网络〃中,让该信息的传递在网上尽力而为地往目的地传送。
    - TCP/IP协议族
        - 面向连接的传输控制协议(TCP)
            - 采用TCP时,传输层向上提供的是一条全双工的可靠逻辑信道;
            - 在传送数据之前必须先建立连接,数据传送结束后要释放连接。 
            - TCP不提供广播或组播服务
            - 由于TCP提供面向连接的可靠传输服务,因此不可避免地增加了许 多开销,如确认、流量控制、计时器及连接管理等。
            - 主要适用于可靠性更重要的场合,如文件传输协议(FTP) 、 超文本传输协议(HTTP) 、远程登录(TELNET) 等。
        - 无连接的用户数据报协 议(UDP)
            - 采用UDP时,传输层向上提供的是一条不可靠的逻辑信道。
            - 两个附加服务
                - 多路复用
                - 对 数据的错误检查
            - UDP在传送数据之前不需要先建立连接,远程主机的传输层收到UDP报文后,不需要给 出任何确认。
            - 执行速度比较快、实时性好。
            - 应用主要包括 小文件传送协议(TFTP) 、DNS、SNMP和实时传输协议(RTP) 。

### 5.2 UDP 协议

- 5.2.1 UDP数据报
  
    - 1. UDP概述
        - 做了传输协议能够做的最少工作,它仅在IP的数据报服务之上增 加了两个最基本的服务:复用和分用以及差错检测。
        - 优点
            - 1) UDP无须建立连接。因此UDP不会引入建立连接的时延。
            - 2) 无连接状态。TCP需要在端系统中维护连接状态。此连接状态包括接收和发送缓存、拥 塞控制参数和序号与确认号的参数。而UDP不维护连接状态,也不跟踪这些参数。因此, 某些专用应用服务器使用UDP时,一般都能支持更多的活动客户机。
            - 3) 分组首部开销小。TCP有20B的百部开销,而UDP仅有8B的开销
            - 4) 应用层能更好地控制要发送的数据和发送时间。UDP没有拥塞控制,因此网络中的拥塞 不会影响主机的发送效率。
        - 特点
            - UDP常用于一次性传输较少数据的网络应用.如DNS、SNMP等
            - UDP也常用于多媒体应用(如IP电 话、实时视频会议、流媒体等)
            - UDP提供尽最大努力的交付,即不保证可靠交付,但这并不意味着应用对数据的要求是不可 靠的,因此所有维护传输可靠性的工作需要用户在应用层来完成。
            - UDP是面向报文的。发送方UDP对应用层交下来的报文,在添加首部后就向下交付给IP层, 既不合并,也不拆分,而是保留这些报文的边界;接收方UDP对IP层交上来UDP用户数据报, 在去除首部后就原封不动地交付给上层应用进程,一次交付一个完整的报文。因此报文不可分割, 是UDP数据报处理的最小单位。
    - 2. UDP的首部格式
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FEiEybJPD7q.png?alt=media&token=efe9314c-6331-4340-8059-f60ddafe0698)
        - 1) 源端口。源端口号。在需要对方回信时选用,不需要时可用全0。
        - 2)  目的端口。目的端口号。这在终点交付报文时必须使用到。
            - 如果接收方UDP发现收到的报文中的目的端口号不正确(即不 存在对应于端口号的应用进程),那么就丢弃该报文,并由ICMP发 送“端口不可达”差错报文给发送方。
        - 3)  长度。UDP数据报的长度(包括首部和数据),其最小值是8 (仅有首部)。
        - 4)  校验和。检测UDP数据报在传输中是否有错。有错就丢弃。该字段是可选的,当源主机 不想计算校验和时,则直接令该字段为全0。
- 5.2.2 UDP 校验
    - 在计算校验和时,要在UDP数据报之前增加12B的伪首部,伪首部并不是UDP的真正首部。
    - 只是在计算校验和时,临时添加在UDP数据报的前面,得到一个临时的UDP数据报。校验和就 是按照这个临时的UDP数据报计算的。
    - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F0vLDKEKmFx.png?alt=media&token=1045817d-7521-4158-875b-24a1cc702c4a)
    - UDP校验和的计算方法
        - 发送方
            - Subtopic
            - 使用二进制反码运算求 和再取反。
            - 首先把全零放入校验和字段并添加伪首部,
            - 把UDP数据报视为许多16位的字连 接起来。
            - 若UDP数据报的数据部分不是偶数个字节,则要在数据部分末尾增加一个全零字节(但 此字节不发送)。
            - 按二进制反码计算出这些16位字的和,并将此和的二进制反码写入校验 和字段。
        - 接收方
            - 把收到的UDP数据报加上伪首部(如果不为偶数个字节,那么还需要补上全零 字节)后,
            - 按二进制反码计算出这些16位字的和。
            - 当无差错时其结果应全为L否则表明有差错 出现,接收方就应该丢弃这个UDP数据报。

### 5.3 TCP协议

- 5.3.1 TCP协议的特点
  
    - 概述
        - 在不可靠的IP层之上实现的可靠的数据传输协议
        - 主要解决传输的可靠、有序、 无丢失和不重复问题。
    - 主要特点
        - 1) TCP是面向连接的传输层协议。
        - 2)  每条TCP连接只能有两个端点,每条TCP连接只能是点对点的(一对一)。
        - 3)  TCP提供可靠的交付服务,保证传送的数据无差错、不丢失、不重复且有序。
        - 4)  TCP提供全双工通信,允许通信双方的应用进程在任何时候都能发送数据,为此TCP连 接的两端都设有发送缓存和接收缓存,用来临时存放双向通信的数据。
            - 发送缓存用来暂时存放以下数据:
                - 1. 发送应用程序传送给发送方TCP准备发送的数据;
                - 2. TCP已发送但尚未收到确认的数据。
            - 接收缓存用来暂时存放以下数据:
                - 1. 按序到达但 尚未被接收应用程序读取的数据;
                - 2. 不按序到达的数据。
        - 5) TCP是面向字节流的,虽然应用程序和TCP的交互是一次一个数据块(大小不等),但 TCP把应用程序交下来的数据仅视为一连串的无结构的字节流。
- 5.3.2 TCP报文段
    - 概述
        - TCP传送的数据单元称为报文段。
        - 一个TCP报文段分为TCP首部和TCP数据两部分
        - TCP报文段的首部最短为20B,后面有4N字节是根据需要而增加的选项,通常长 度为4B的整数倍。
    - 作用
        - TCP报文段既可以用来运载数据,又可以用来建立连接、释放连接和应答。
    - 示例
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F5LJJyohIF9.png?alt=media&token=f657ec6c-83a4-4614-b5f7-7557db7c0ce7)
    - 各字段意义
        - 1) 源端口和目的端口字段。
            - 各占2B。
            - 端口是运输层与应用层的服务接口,运输层的复用和 分用功能都要通过端口实现。
        - 2) 序号字段。
            - 占4B。
            - TCP是面向字节流的(即TCP传送时是逐个字节传送的),所以TCP 连接传送的数据流中的每个字节都编上一个序号。序号字段的值指的是本报文段所发送 的数据的第一个字节的序号。
        - 3)  确认号字段。
            - 占4B
            - 期望收到对方的下一个报文段的数据的第一个字节的序号。若确认 号为M则表明到序号N- 1为止的所有数据都已正确收到。
        - 4)  数据偏移(即首部长度)。
            - 占4位
            - 表示 首部长度,它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远。
            - 单位是32位(以4B为计算单位)。
        - 5)  保留字段。
            - 占6位,
            - 目前应置为0
        - 6)  紧急位URG。
            - URG= 1时,表明紧急指针字段有效。
            - 告诉系统报文段中有紧急数据, 应尽快传送(相当于高优先级的数据)。
            - URG需要和紧急指针配套使用,即数据从第 一个字节到紧急指针所指字节就是紧急数据。
        - 7)  确认位ACK。
            - 只有当ACK=1时确认号字段才有效。当ACK = 0时,确认号无效。
            - TCP规定,在连接建立后所有传送的报文段都必须把ACK置1。
        - 8)  推送位PSH ( Push)
            - 接收TCP收到PSH=1的报文段,就尽快地交付给接收应用进程, 而不再等到整个缓存都填满后再向上交付。
        - 9)  复位位RST ( Reset) 
            - RST=1时,表明TCP连接中出现严重差错(如主机崩溃或其他原 因),必须释放连接,然后再重新建立运输连接。
        - 10)  同步位SYN
            - 同步SYN=1表示这是一个连接请求或连接接收报文。
            - 当SYN=L ACK = 0时,表明这是一个连接请求报文?对方若同意建立连接,
            - 在响应 报文中使用SYN=1, ACK=1。
        - 11)  终止位FIN ( Finish)
            - 用来释放一个连接。FIN= 1表明此报文段的发送方的数据已发送 完毕,并要求释放传输连接。
        - 12)  窗口字段。
            - 占2B。
            - 指出现在允许对方发送的数据量
            - 例如,假设确认号是70L窗口字段是1000。这表明,从701一号算起,发送此报文段的 一方还有接收1000B数据(字节序号为701-1700) 的接收缓存空间。
        - 13)  校验和。
            - 占2B。
            - 校验和字段检验的范围包括首部和数据两部分。
            - 在计算校验和时,和 UDP 一样,要在TCP报文段的前面加上12B的伪首部
        - 14)  紧急指针字段。
            - 占16位
            - 指出在本报文段中紧急数据共有多少字节(紧急数据放在本 报文段数据的最前面)。
        - 15)  选项字段。
            - 长度可变。
            - TCP最初只规定了一种选项,即最大报文段长度( Maximum Segment Size, MSS) O MSS是TCP报文段中的数据字段的最大长度。
        - 16)  填充字段。
            - 这是为了使整个首部长度是4B的整数倍。
- 5.3.3 TCP连接管理
    - 概述
        - 每个TCP连接都有三个阶段
            - 连接建立、数据传送和连接释 放。
        - TCP连接的管理就是使运输连接的建立和释放都能正常进行。
        - 解决以下三个问题
            - 1) 要使每一方都能够确知对方的存在。
            - 2)  要允许双方协商一些参数(如最大窗口值、是否使用窗口扩大选项、时间戳选项及服务 质量等)。
            - 3)  能够对运输实体资源(如缓存大小、连接表中的项目等)进行分配。
        - 每条TCP连接唯一地被通信两端的两个端点(即两个套接字)确定。
    - 1. TCP连接的建立
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FVABzx0ibT9.png?alt=media&token=02be4f93-c618-47b4-8db7-16b19a66f94e)
        - 过程
            - A→ B：SYN = 1 ，ACK = 0，seq = x (x随机)
            - B→ A：SYN = 1 ，ACK = 1，seq = y (y随机)，ack = x+1
            - A→ B：SYN = 0 ，ACK = 1，seq = x+1，ack = y+1 （不携带数据则不消耗序号）
    - 2. TCP连接的释放
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FvIlF2C8gGT.png?alt=media&token=32a9ef3d-6650-4418-b63f-1a253889a429)
        - 过程
            - A → B：FIN = 1 ，seq = u (最后一个序号)。释放申请
            - B → A：FIN = 0 ，ACK = 1 ，seq = v ，ack = u + 1  (确认收到释放申请)。半闭合状态。
            - B → A：FIN = 1 ，ACK = 1 ，seq = w ，ack = u + 1 。通知释放。
            - A → B：FIN = 0 ，ACK = 1 ，seq = u + 1 ，ack = w + 1 。释放
    - SYN 泛洪攻击
        - 过程
            - SYN洪泛攻击发生在OSI第四层,这种方式利用TCP协议的特性,就是三次握手攻击者发送 TCP
            - 攻击者发送 TCP三次握手中的第一个数据包,而当服务器返回  TCP三次握手中的第二个数据包后, 该攻击者就不对其进行再确认。
            - 那这个TCP连接就处于挂起状态,也就是所谓的半连接状态,服务器收不到再确认的话,还会重复发送ACK给攻击者。
        - 影响
            - 浪费服务器的资源
            - 在服务器上,这些TCP连接会因为挂起状态而消耗CPU和内存,最后服务器可能死机
- 5.3.4 TCP可靠传输
    - 1. 序号
        - 序号字段用来保证数据能有序提交给应用层,TCP把数据视为一个无结构但有序 的字节流,序号建立在传送的字节流之上,而不建立在报文段之上。
        - TCP连接传送的数据流中的每个字节都编上一个序号。序号字段的值是指本报文段所发送的数据的第一个字节的序号。
    - 2. 确认
        - 确认号是期望收到对方的下一个报文段的数据的第一个字节的序号。
        - 发送方缓存区会继续存储那些已发送但未收 到确认的报文段,以便在需要时重传。
        - TCP默认使用累计确认,即 TCP 只确认数据流中至第一个丢失字节为止的字节。返回的 ack 为未确认的第一个字节的序号。
    - 3. 重传
        - 两种事件
            - (1) 超时
                - TCP每发送一个报文段,就对这个报文段设置一次计时器。
                - 计时器设置的重传时间到期但还 未收到确认时,就要重传这一报文段。
                - 超时计时器的重传时间
                    - TCP采用一种自适应算法
                    - 报文段的往返时间(Round-Trip Time, RTT) = 一个报文段发出的时间,以及收到相应确认的时间,这两个时间之差
                    - new_RTTS = （1-\alpha) * old_RTTS + \alpha * new_RTT , 推荐 \alpha = 0.125
                    - new_RTTD = (1-\beta) * old_RTTD + \beta * |RTTS - new_RTT|, 推荐 \beta = 0.25
                    - 超时重传时间(Retransmission Time-Out,RTO) = RTTS + 4 * RTTD
            - (2) 冗余ACK (冗余确认)
                - 发送方通常可在超时事件发生 之前通过注意所谓的冗余ACK来较好地检测丢包情况。
                - TCP规定每当比期望序号大的失序报文段到达时,就发送一个冗余ACK, 指明下一个期待字节的序号[RFC 1122, RFC 2581]。
                - TCP规定当发送方收到对同一个报文段的3个冗余ACK时,就可以认为跟在这个被 确认报文段之后的报文段已经丢失。
                - 这种技术通常称为快速重传。
                - Seq 的表现情况
                    - 当序号为 x 的报文丢失时，发送对x - 1 号报文的冗余ACK。
                      
                    - ```
                      A 的发送情况：
                        A → B: seq = x - 1  (收到)
                        A → B: seq = x (未收到)
                       
                      B的表现：
                        B → A: seq = x 
                        B → A: seq = x
                        B → A: seq = x
                      ```
                      
    
- 5.3.5 TCP流量控制
  
    - 概述
        - TCP提供流量控制服务来消除发送方使接收方缓存区溢出的可能性,因此可以说流量控制是 一个速度匹配服务
        - TCP提供一种基于滑动窗口协议的流量控制机制,
    - 原理
        - 接收方：根据自己接收缓存的大小,动态地调整发送方的发送窗口大小,这称为接收窗口 rwnd,即调整TCP报文段首部中的“窗口〃字段值,来限制发送方向网络注入报文的速率。
            - A发送数据给B，则 B发给A的TCP报文中的窗口字段表示：还能发送从 ack 起，共“窗口”大小的字节数。
        - 发送方根据其对当前网络拥塞程序的估计而确定的窗口值,这称为拥塞窗口 cwnd ,其大小与网络的带宽和时延密切相关。
            - A 的发送窗口大小，由 rwnd 与拥塞窗口 cwnd 共同决定（取较小的）。
- 5.3.6 TCP拥塞控制
    - 概述
        - 指防止过多的数据注入网络,保证网络中的路由器或链路不致过载。
        - 出现拥塞时,端点并不了解到拥塞发生的细节,对通信连接的端点来说,拥塞往往表现为通信时延的 增加。
        - 拥塞控制与流量控制的区别:
            - 拥塞控制是让网络能够承受现有的网络负荷,是一个全局性的 过程,涉及所有的主机、所有的路由器,以及与降低网络传输性能有关的所有因素。
            - 流量 控制往往是指点对点的通信量的控制,即接收端控制发送端,它所要做的是抑制发送端发送数据 的速率,以便使接收端来得及接收。
        - 因特网建议标准定义了以下4种算法
            - 慢开始、拥塞避 免、快重传、快恢复。
        - TCP协议要求发送方维护以下两个窗口
            - 1)  接收窗口 rwnd
                - 接收方根据目前接收缓存大小所许诺的最新窗口值,反映接收方的容量。 
                - 由接收方根据其放在TCP报文的首部的窗口字段通知发送方。
            - 2)  拥塞窗口 cwnd
                - 发送方根据自己估算的网络拥塞程度而设置的窗口值,反映网络的当前 容量。只要网络未出现拥塞,拥塞窗口就再增大一些,以便把更多的分组发送出去。但 只要网络出现拥塞,拥塞窗口就减小一些,以减少注入网络的分组数。
            - 发送窗口的上限值应取接收窗口 rwnd和拥塞窗口 cwnd中较小的一个
                - 发送窗口的上限值=min[rwnd, cwnd]
    - 1. 慢开始和拥塞避免
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FnrC7KSAtVL.png?alt=media&token=3ff0a5cb-5eb2-42ad-8054-17d81379e102)
        - (1) 慢开始算法 cwnd < ssthresh
            - 按 ack 线性增长；按照 RTT 指数增长
            - 过程
                - 令 cwnd = 1，即一个最大报文段长度（MSS）。
                - 每收到一个新的报文段的确认后，cwnd + 1
                - 以指数增长，到门限 ssthresh （阈值）为止
        - (2)  拥塞避免算法 condo > ssthresh
            - 过程
                - 线性增加，每个 RTT 后 cwnd + 1
                - 出现一次超时后，ssthresh = cwnd 的一半
            - 根据cwnd的大小执行不同的算法
                - 当cwnd < ssthresh时,使用慢开始算法。
                - 当cwnd > ssthresh时,停止使用慢开始算法而改用拥塞避免算法。
                - 当cwnd = ssthresh时,既可使用慢开始算法,又可使用拥塞避免算法(通常做法)。
        - (3)  网络拥塞的处理
            - 网络出现拥塞时,无论是在慢开始阶段还是在拥塞避免阶段,只要发送方检测到超时事件的 发生(未按时收到确认,重传计时器超时),就要把慢开始门限ssthresh设置为出现拥塞时的发送 方的cwnd值的一半(但不能小于2) 。
    - 2. 快重传和快恢复
        - (1)  快重传
            - 冗余ACK也用于网络拥塞的检测(丢了包当然意味着网络可能出现了拥塞)。
            - 快重传并非取 消重传计时器,而是在某些情况下可更早地重传丢失的报文段。
        - (2)  快恢复
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FVQqTavE-rh.png?alt=media&token=f842cbcc-d258-47e1-8c2f-a86889d13eaa)
            - 过程
                - 收到 3 个冗余 ACK 后，直接重传对应报文。
                - 令 sshresh = 一半的cwnd，且cwnd 也为原来的一半。（不必从 1 指数增长到 sshresh）

<div style="page-break-after:always;"></div>

## 第六章 应用层

- ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FwtTKpNvY-m.png?alt=media&token=e6423792-3cea-400f-b737-8d2e67aba44d)

### 6.1 网络应用模型

- 6.1.1 客户/服务器模型
    - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FdPAx0S2n_E.png?alt=media&token=5d5c9f97-816d-4074-a055-96758e5f5422)
    - 服务器
        - 总是打开的主机
        - 服务于 许多来自其他称为客户机的主机请求
        - 服务器上运行的软件则是专门用来提供某种服务的程序,可同时处理多个远程或本地客户的要 求。
            - 系统启动后即自动调用并一直不断地运行着,被动地等待并接收来自各地客户的请求。
        - 服务器程序不需要知道客户程序的地址。
        - 工作流程
            - 1) 服务器处于接收请求的状态。
            - 2)  客户机发出服务请求,并等待接收结果。
            - 3) 服务器收到请求后,分析请求,进行必要的处理,得到结果并发送给客户机。
    - 客户程序
        - 必须知道服务器程序的地址
        - 一般不需要特殊的硬件和复杂的操作系统。
    - 客户/服务器模型最主要的特征
        - 客户是服务请求方,服务器是服务提供方。
        - 如Web应用程 序,其中总是打开的Web服务器服务于运行在客户机上的浏览器的请求。当Web服务器接收到来 自客户机对某对象的请求时,它向该客户机发送所请求的对象以做出响应。
    - 常见的使用客户/服务 器模型
        - Web、文件传输协议( FTP、远程登录和电子邮件等。
    - 主要特点
        - 1)  网络中各计算机的地位不平等,
            - 服务器可以通过对用户权限的限制来达到管理客户机的 目的,使它们不能随意存储/删除数据,或进行其他受限的网络活动。
            - 整个网络的管理工 作由少数服务器担当,因此网络的管理非常集中和方便。
        - 2)  客户机相互之间不直接通信。
            - 例如,在Web应用中两个浏览器并不直接通信。
        - 3)  可扩展性不佳。
            - 受服务器硬件和网络带宽的限制,服务器支持的客户机数有限。
        - 服务器性能的好坏决定了整个系统的性能,当大量用户请 求服务时,月艮务器就必然成为系统的瓶颈。
- 6.1.2 P2P 模型
    - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FSdA1MezaQF.png?alt=media&token=a3441dff-4fb9-45bd-9107-573cefb9a5e9)
    - 思想是整个网络中的传输内容不 再被保存在中心服务器上,每个结点都同时具有下载、上传的功能,其权利和义务都是大体对等的。
    - 各计算机没有固定的客户和服务器划分。
        - 任意一对计算机— —称为对 等方( Peer),直接相互通信。
    - 从本质上来看仍然使用客户/服务器方式,每个结 点既作为客户访问其他结点的资源,也作为服务器提供资源给其他结点访问。
    - 比较流行的P2P 应用
        - PPlive、Bittorrent和电驴等。
    - 优点
        - 1)  减轻了服务器的计算压力,消除了对某个服务器的完全依赖,可以将任务分配到各个结 点上,因此大大提高了系统效率和资源利用率
        - 2)  多个客户机之间可以直接共享文档。
        - 3)  可扩展性好,传统服务器有响应和带宽的限制,因此只能接受一定数量的请求。
        - 4)  网络健壮性强,单个结点的失效不会影响其他部分的结点。
    - 缺点
        - 在获取服务的同时,还要给其他结点提供服务,因此会占用较多的内存, 影响整机速度。
        - 据某互联网调研机构统计, 当前P2P程序已占互联网50%〜90%的流量,使网络变得非常拥塞,因此各大ISP (互联网服务 提供商,如电信、网通等)通常都对P2P应用持反对态度。

### 6.2 域名系统(DNS)

- 是因特网使用的命名系统,用来把便于人们记忆的 具有特定含义的主机名转换为便于机器处理的IP地址。
- DNS系统采用 客户/服务器模型,其协议运行在UDP之上,使用53号端口。
- DNS分为3部分
    - 6.2.1 层次域名空间
        - 图6.4域名空间的树状结构
        - 因特网采用层次树状结构的命名方法。
        - 采用这种命名方法,任何一个连接到因特网的主机或 路由器,都有一个唯一的层次结构名称,即域名( Domain Name)
        - 域( Domain) 是名字空间中 一个可被管理的划分。
            - 域还可以划分为子域,而子域还可以继续划分为子域的子域,这样就形成 了顶级域、二级域、三级域等。
        - 个域名都由标号序列组 成,而各标号之间用点(“.”)隔开。
        - 注意
            - 1) 标号中的英文不区分大小写。
            - 2)  标号中除连字符(-) 外不能使用其他的标点符号。
            - 3)  每个标号不超过63个字符,多标号组成的完整域名最长不超过255个字符。
            - 4)  级别最低的域名写在最左边,级别最高的顶级域名写在最右边。
        - 顶级域名(Top Level Domain, TLD) 分为如下三大类
            - 1)  国家顶级域启( nTLD)
                - 如“.cn”表示中国,“.us”表示美国, “.uk”表示英国。
            - 2)  通用顶级域名( gTLD)
                - 常见的有“.com”( 公司)、".net"( 网络服务机构)、“.org”(非营利性组织)和".gov"( 国家或政府部门)等。
            - 3)  基础结构域名
                - 只有一个,即 arpa,用于反向域名解析,因此又称反向 域名。
    - 6.2.2 域名服务器
        - 概述
            - 因特网的域名系统被设计成一个联机分布式的数据库系统,并采用客户/服务器模型。
            - 域名到 IP地址的解析是由运行在域名服务器上的程序完成的,一个服务器所负责管辖的范围称为区（“域〃的一部分),各单位根据具体情况来划分自己管辖范围的区,但在一个区中的所有结点必须是能够连通的,每个区设置相应的权限域名服务器,用来保存该区中的所有主 机的域名到IP地址的映射。
            - 每个域名服务器不但能够进行一些域名到IP地址的解析,而且还必 须具有连向其他域名服务器的信息。当自己不能进行域名到IP地址的转换时,能够知道到什么地 方去找其他域名服务器。
            - 没有一台域名服务器具有因特网上所 有主机的映射,相反,该映射分布在所有的DNS ±o采用分布式设计的DNS,是一个在因特网 上实现分布式数据库的精彩范例。
        - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FUfa9pN3Gbz.png?alt=media&token=9e53b1b8-c190-43fd-9f7a-b359b7760218)
        - 1. 根域名服务器
            - 是最高层次的域名服务器,所有的根域名服务器都知道所有的顶级域名服务器 的IP地址。
            - 根域名服务器也是最重要的域名服务器,不管是哪个本地域名服务器,若要对因特网 上任何一个域名进行解析,只要自己无法解析,就首先要求助于根域名服务器。
            - 根域名服务器用来管 辖顶级域(如-com),通常它并不直接把待查询的域名直接转换成IP地址,而是告诉本地域名服 务器下一步应当找哪个顶级域名服务器进行查询。
        - 2. 顶级域名服务器
            - 这些域名服务器负责管理在该顶级域名服务器注册的所有二级域名。
            - 收到DNS查询请求时, 就给出相应的回答
        - 3. 授权域名服务器
            - 二级及以下的域名服务器。
            - 每台主机（网站服务器的主机）都必须在授权域名服务器处登记。
            - 实际上,许多域名服务器都同时充当本地域名服务器和授权域名服务器。
            - 授权域名服务器总能将其管辖的主机名转换为该主机的IP地址。
        - 4. 本地域名服务器
            - 每个因特网服务提供者(ISP),或一所大学,甚至一所大学中的各个系,甚至计算机内都可以拥有一个本地域名服务器。
            - 当一台主机发出DNS查询请求时,这个 查询请求报文就发送给该主机的本地域名服务器。
    - 6.2.3 域名解析过程
        - 域名解析是指把域名映射成为IP地址或把IP地址映射成域名的过程。前者称为正向解析, 后者称为反向解析。
        - 当客户端需要域名解析时,通过本机的DNS客户端构造一个DNS请求报文, 以UDP数据报方式发往本地域名服务器。
        - 两种方式
            - 递归查询
                - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FT-JuckdDB1.png?alt=media&token=69763879-dc76-43bd-8282-5786d7a3b848)
                - 本地域名服务器只需向根域名服 务器查询一次
            - 递归与迭代相结合的查询。
                - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F9T_S5Bq4W5.png?alt=media&token=af8f6a49-bf85-4591-9853-cc7f695cc42d)
        - 为了提高DNS的查询效率,并减少因特网上的DNS查询报文数量,在域名服务器中广泛地 使用了高速缓存。

### 6.3 文件传输协议(FTP)

- 6.3.1 FTP的工作原理
    - 概述
        - 是因特网上使用得最广泛的文件传输协议。
        - FTP 提供交互式的访问,允许客户指明文件的类型与格式,并允许文件具有存取权限。
        - 它屏蔽了各计 算机系统的细节,因而适合于在异构网络中的任意计算机之间传送文件。
        - FTP采用客户/服务器的工作方式,它使用TCP可靠的传输服务。
        - 一个FTP服务器进程可同 时为多个客户进程提供服务。
    - 功能
        - 1 提供不同种类主机系统(硬、软件体系等都可以不同)之间的文件传输能力。
        - 2 以用户权限管理的方式提供用户对远程FTP服务器上的文件管理能力。
        - 3 以匿名FTP的方式提供公用文件共享的能力。
    - 服务器进程的两大部分组成
        - 一个主进程,负责接收新的请 求;
        - 另外有若干从属进程,负责处理单个请求。
    - 服务端的工作步骤
        - 1 打开熟知端口 21 (控制端口),使客户进程能够连接上。
        - 2 等待客户进程发连接请求
        - 3 启动从属进程来处理客户进程发来的请求。
            - 主进程与从属进程并发执行,从属进程对客 户进程的请求处理完毕后即终止。
        - 4 回到等待状态,继续接收其他客户进程的请求。
    - 特点
        - FTP服务器必须在整个会话期间保留用户的状态信息。
        - 特别是服务器必须把指定的用户账户 与控制连接联系起来,服务器必须追踪用户在远程目录树上的当前位置。
        - 使用FTP时,若要修改服务器上的文件,则需要先将此文件传送到本地主机,然后再将修 改后的文件副本传送到原服务器。
            - 网络文件系统(NFS) 允许进程打开一个远程文件,并在该文 件的某个特定位置开始读写数据。这样,NFS可使用户复制一个大文件中的一个很小的片段,而 不需要复制整个大文件。
- 6.3.2 控制连接与数据连接
    - FTP在工作时使用两个并行的TCP连接
    - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F6dYnquvjHH.png?alt=media&token=9ad7ff55-1865-478c-9258-2b9ef4aa450f)
    - 控制连接(端口号21)
        - 服务器监听21号端口,等待客户连接,建立在这个端口上的连接称为控制连接,
        - 控制连接 用来传输控制信息(如连接请求、传送请求等),并且控制信息都以7位ASCII格式传送。
        - 在传输文件时还可以使用控制连接
        - 控制连接 在整个会话期间一直保持打开状态。
        - 因为FTP使用了一个分离的控制连接,所以也称FTP的控制信息是带外( Out-of-band) 传 送的。
    - 数据连接(端口号20)
        - 服务器端的控制进程在接收到FTP客户发来的文件传输请求后,就创建“数据传送进程"和 “数据连接〃。
        - 据连接用来连接客户端和服务器端的数据传送进程,数据传送进程实际完成文件 的传送,在传送完毕后关闭“数据传送连接〃并结束运行。

### 6.4 电子邮件

- 6.4.1 电子邮件系统的组成结构
    - 三个最主要的组成构件
        - 用户代理(User Agent)
            - 用户与电子邮件系统的接口。
            - 通常情况下,用户代理 就是一个运行在PC上的程序,常见的有Outlook、Foxmail和Thunderbird等
        - 邮件服务器
            - 组成电子邮件系统的核心。
            - 功能是发送和接收邮件,同时还要向发信人报告邮件传送情况（已交付、被拒绝、丢失等）。
            - 采用 C/S 工作
        - 电子邮件使用的协议
            - 如SMTP、POP3 (或IMAP)
            - 邮件发送协议用于用户代理向邮件服务器发送邮件或在邮件服务 器之间发送邮件,通常使用的是SMTP;
                - SMTP采用的是“推” ( Push) 的通信方式,即在用户代理向邮件服务器发送邮件 及在邮件服务器之间发送邮件时,SMTP客户端主动将邮件“推”送到SMTP服务器端。
            - 邮件读取协议用于用户代理从邮件服务器读取邮件,如 POP3。
                - POP3 采用的是“拉〃(Pull) 的通信方式,即用户读取邮件时,用户代理向邮件服务器发出请求,“拉“ 取用户邮箱中的邮件。
        - 电子邮件的收发过程。
            - 1 发信人调用用户代理来撰写和编辑要发送的邮件。用户代理用SMTP把邮件传送给发送 方邮件服务器。
            - 2 发送方邮件服务器将邮件放入邮件缓存队列中,等待发送。
            - 3 运行在发送方邮件服务器的SMTP客户进程,发现邮件缓存中有待发送的邮件,就向运 行在接收方邮件服务器的SMTP服务器进程发起建立TCP连接。
            - 4 TCP连接建立后,SMTP客户进程开始向远程SMTP服务器进程发送邮件。当所有待发送 邮件发完后,SMTP就关闭所建立的TCP连接。
            - 5 运行在接收方邮件服务器中的SMTP服务器进程收到邮件后,将邮件放入收信人的用户 邮箱,等待收信人在方便时进行读取。
            - 6 收信人打算收信时,调用用户代理,使用POP3 (或IMAP) 协议将自己的邮件从接收方 邮件服务器的用户邮箱中取回(如果邮箱中有来信的话)。
        - 注意
            - 用户可以通过浏览器，使用 http 协议与邮件服务器交流发送邮件。
- 6.4.2 电子邮件格式与MIME
    - 1.电子邮件格式
        - 信封
            - 用户写好首部后,邮件系统自动地将 信封所需的信息提取出来并写在信封上,用户不需要亲自填写信封上的信息。
        - 内容
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2Fx785Dkj2kn.png?alt=media&token=5504f6c4-3666-4149-800d-6e48a9303c73)
            - 首部
                - 用户填写
                - 包含一些首部行,每个首部行由一个关键字后跟冒号再后跟值组成。
                - 最重要的关键字是 To:和Subject:
                    - To是必需的关键字,后面填入一个或多个收件人的电子邮件地址。
                    - Subject是可选关键字,是邮件的主题,反映了邮件的主要内容。
                - From,但它通常由邮件系统自动填入。
            - 主体
                - 用户自由撰写
    - 2. 多用途网际邮件扩充(MIME)
        - SMTP只能传送一定长度的ASCII码
            - 无法传送其他语言与字符，以及可执行文件与二进制对象
        - MIME并未改动SMTP或取代它
            - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F92VYI9M7XE.png?alt=media&token=23744903-a806-45e5-bbaf-cf4c585c5c0d)
            - 继续使用目前的格式,但增加了邮件主体的结 构,并定义了传送非ASCII码的编码规则。也就是 说,MIME邮件可在现有的电子邮件程序和协议下 传送。
        - 包括三部分内容
            - 1. 5个新的邮件首部字段、内容描述、内容标识、内容传送编码和内容类型
            - 2. 定义了许多邮件内容的格式,对多媒体电子邮件的表示方法进行了标准化。
            - 3. 定义了传送编码,可对任何内容格式进行转换,而不会被邮件系统改变。
- 6.4.3 SMTP 和 POP3
    - 1. SMTP
        - 提供可靠且有效的电子邮 件传输的协议,它控制两个相互通信的SMTP进程交换信息。
        - 用的是TCP连接,端口号为25。
        - 三个阶段
            - ( 1) 连接建立
                - 客户端请求发起（发件人发送邮件到发送方邮件缓存）
                - 使用SMTP的熟知端口号(25) 与接收方邮件服务器的SMTP 服务器建立TCP连接。
                - 接收方SMTP服务器发出220 Service ready (服务就绪)。
                - SMTP客户向SMTP服务器发送HELO命令,附上发送方的主机名。
                - STMP服务器向STMP客户发送 “250 OK ”返回
            - ( 2)  邮件传送
                - Client: From 用户@域名
                - server： 250 ok
                - Client: RCPT 命令。TO 收件人地址
                - server： 250 ok 或者 550 No such user here
                - Client：DATA 命令。
                - Server: “354 Start mail input；end with <CRLF>.<CRLF>”
                - Client: 内容，以 <CRLF>.<CRLF> 结束
            - ( 3)  连接释放
                - SMTP客户应发送QUIT命令
                - SMTP服务器返回的信息是221 ( 服务关闭),表示SMTP同意释放TCP连接。
    - 2. POP3
        - 在传输层使用TCP,端口号为110。
        - 两种工作方式
            - 用户决定
            - 下载并保留
            - 下载并删除
        - 因特网报文存取协议(IMAP)
            - IMAP为用户提 供了创建文件夹、在不同文件夹之间移动邮件及在远程文件夹中查询邮件的命令
            - IMAP服 务器维护了会话用户的状态信息。
            - 允许用户代理只获取报文的某些部分,例 如可以只读取一个报文的首部,或一个多部分MIME报文的一部分。

### 6.5 万维网(WWW)

- 6.5.1 WWW的概念与组成结构
  
    - 概述
        - 是一个资料空间
        - 一样有用的事物称为 一样“资源”,并由一个全域“统一资源定位符”( URL) 标识。
        - 资源通过超文本传输协议( HTTP) 传送给使用者
    - 超文本标记语言(HyperText Markup Language, HTML) 使得万维网 页面的设计者可以很方便地用一个超链接从本页面的某处链接到因特网上的任何一个万维网页 面,并能够在自己的计算机屏幕上显示这些页面。
    - 三个标准构成
        - 1)  统一资源定位符(URL) 。
            - 负责标识万维网上的各种文档,并使每个文档在整个万维网的 范围内具有唯一的标识符URLo
            - URL的一般形式是:<协议>://<主机>:<端口>/<路径>。
                - 常见的〈协议>有 http、ftp等;
                - <主机<是存放资源的主机在因特网中的域名,也可以是IP地 址;
                - <端口>和<路径>有时可以省略。
                - 在URL中不区分大小写
        - 2)  超文本传输协议( HTTP) 
            - 一个应用层协议,它使用TCP连接进行可靠的传输,HTTP 是万维网客户程序和服务器程序之间交互所必须严格遵守的协议。
        - 3)  超文本标记语言(HTML) 。
            - 一种文档结构的标记语言,它使用一些约定的标记对页面上 的各种信息(包括文字、声音、图像、视频等)、格式进行描述。
    - 以客户/服务器方式工作。
        - 浏览器是在用户计算机上的万维网客户程序
        - 万维网文档 所驻留的计算机则运行服务器程序,这台计算机称万维网服务器。
            - 工作流程
                - 1)  Web用户使用浏览器(指定URL) 与Web服务器建立连接,并发送浏览请求。
                - 2)  Web服务器把URL转换为文件路径,并返回信息给Web浏览器。
                - 3)  通信完成,关闭连接。
- 6.5.2 超文本传输协议(HTTP)
    - 从层次的角度看,HTTP是面向事务的(TfansEion-oriented) 应用层 协议,它规定了在浏览器和服务器之间的请求和响应的格式与规则,是万维网上能够可靠地交换 文件(包括文本、声音、图像等各种多媒体文件)的重要基础。
    - 1. HTTP的操作过程
        - 它不断地 监听TCP的端口 80( 默认)
        - 在浏览器和服务器之闾的请求与响应的 交互,必须遵循规定的格式和规则,这些格式 和规则就是HTTP
        - 两类报文:
            - 请求报文(从Web客户端向Web服务器发送服务请求)
            - 响应报文(从Web服务器对Web客户 端请求的回答)。
        - 用户单击鼠标后所发生的事件按顺序
            - 1) 浏览器分析链接指向页面的 URL ( http://www.tsinghua.edu.cn/chn/index.htm)
            - 2) 浏览器向DNS请求解析wwv/Isinghuaxdu.cn的IP地址。
            - 3) 域每条缆DNS解忻出清华大学服务器的IP地址。
            - 4)  浏览器与该服务器建立TCP连接(默认端口号为80) 。
            - 5)  浏览器发出 HTTP 请求:GET /chn/index.htm。
            - 6)  服务器通过HTTP响应把文件index.htm发送给浏览器。
            - 7)  TCP连接释放。
            - 8)  浏览器解释文件index.htm,并将Web页显示给用户。
    - 2. HTTP的特点
        - HTTP是无状态的。
            - 通常使用Cookie加数据库的方式来跟踪用户的活动
                - Cookie是一个存储在用户主机中的文本文件
        - HTTP本身是无连接的
            - 通信的双方在交换HTTP报文之前不需要先建立HTTP连接。
        - HTTP既可以使用非持久连接,也可以使用持久连接(HTTP/1.1支持)。
            - 对于非持久连接,每个网页元素对象(如JPEG图形、Flash等)的传输都需要单独建立一个 TCP连接,
                - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2Fof9ThtHL7i.png?alt=media&token=90817f5c-61d3-462f-a9d4-239f1fafbfa0)
            - 持久连接,是指万维网服务器在发送响应后仍然保持这条连接,使同一个客户和服务器 可以继续在这条连接上传送后续的HTTP请求与响应报文
                - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2F8F0T8c5N3L.png?alt=media&token=7a3482f4-1e90-4190-85ea-4b42c7490fa2)
                - 持久连接又分为非流水线和流水线两种方式。
                    - 对于非流水线方式,客户在收到前一个响应后 才能发出下一个请求。
                    - 流水线方式
                        - HTTP/1.1的默认方式是使用流水线的持久连接。
                        - 如果 所有的请求和响应都是连续发送的,那么所有引用的对象共计经历1个RTT延迟,而不是像非流 水线方式那样,每个引用都必须有1个RTT延迟。
                        - 一个对象引用就立即发出一个请求;因而客户可以逐个地连续发出对各个引用对象的请求。
    - 3. HTTP的报文结构
        - 面向文本的
        - 报文中的每个字段都是一些ASCII码串,并且每 个字段的长度都是不确定的。
        - 两类HTTP报文
            - 请求报文:从客户向服务器发送的请求报文
                - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FVBJPLc1Q_L.png?alt=media&token=32f5110b-c705-46d6-b942-c1bedcf8cf27)
            - 响应报文:从服务器到客户的回答
                - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FslZSYBPQYj.png?alt=media&token=d529fff4-e054-470e-97c7-2d36d6eaaa2e)
            - 开始行:
                - 用于区分是请求报文还是响应报文。 
                - 在请求报文中的开始行称为请求行,而在响应报文中的开始行称为状态行。
                - 开始行的三个字段之 间都以空格分隔,最后的“CR”和“LF”分别代 表“回车〃和“换行七
                - 请求报文的“请求行”有 三个内容:方法、请求资源的URL及HTTP的版 本。
                    - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2FAFuture%2FYxRXMssJ31.png?alt=media&token=e57a358f-7302-4ae0-960e-b651ce66d2e5)
            - 首部行:
                - 用来说明浏览器、服务器或报文主体的一些信息。
                - 在 每个首部行都有首部字段名和它的值,每行在结束的地方都要有“回车”和“换行”。
                - 整个首部 结束时,还有一空行将首部行和后面的实体主体分开。
            - 实体主体:
                - 在请求报文中一般不用这个字段,而在响应报文中也可能没有这个字段

